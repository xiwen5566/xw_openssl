<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ssl/record/rec_layer_d1.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('rec__layer__d1_8c_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">rec_layer_d1.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="rec__layer__d1_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Copyright 2005-2016 The OpenSSL Project Authors. All Rights Reserved.</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Licensed under the OpenSSL license (the &quot;License&quot;).  You may not use</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * this file except in compliance with the License.  You can obtain a copy</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * in the file LICENSE in the source distribution or at</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * https://www.openssl.org/source/license.html</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;errno.h&gt;</span></div><div class="line"><a name="l00012"></a><span class="lineno"><a class="line" href="rec__layer__d1_8c.html#acc88493bed5c7a1a3f7485dae7e0f955">   12</a></span>&#160;<span class="preprocessor">#define USE_SOCKETS</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;../ssl_locl.h&quot;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="evp_8h.html">openssl/evp.h</a>&gt;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="buffer_8h.html">openssl/buffer.h</a>&gt;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="record__locl_8h.html">record_locl.h</a>&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;assert.h&gt;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno"><a class="line" href="record_8h.html#a1c19d4078df3d94d67588ec1a572d87e">   19</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="rec__layer__d1_8c.html#a1c19d4078df3d94d67588ec1a572d87e">DTLS_RECORD_LAYER_new</a>(<a class="code" href="structRECORD__LAYER.html">RECORD_LAYER</a> *rl)</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;{</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <a class="code" href="structDTLS__RECORD__LAYER.html">DTLS_RECORD_LAYER</a> *d;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <span class="keywordflow">if</span> ((d = <a class="code" href="crypto_8h.html#afdb80d14aed3b15d0ef71f72a872310d">OPENSSL_malloc</a>(<span class="keyword">sizeof</span>(*d))) == <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>)</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        <span class="keywordflow">return</span> (0);</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    rl-&gt;<a class="code" href="structRECORD__LAYER.html#ab791e525d7d88c4e178d69a01f41b3a8">d</a> = d;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    d-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a3b9c346ebe7a3f53056ee6837f9f928d">unprocessed_rcds</a>.<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a> = <a class="code" href="pqueue_8c.html#ab02c706ca2d314a5aedcc61d1574597e">pqueue_new</a>();</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    d-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a987fed78e6be6e293938b2a5f5de5ab8">processed_rcds</a>.<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a> = <a class="code" href="pqueue_8c.html#ab02c706ca2d314a5aedcc61d1574597e">pqueue_new</a>();</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    d-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a3b9e5d3a9658a6a92596f38a866496d0">buffered_app_data</a>.<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a> = <a class="code" href="pqueue_8c.html#ab02c706ca2d314a5aedcc61d1574597e">pqueue_new</a>();</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordflow">if</span> (d-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a3b9c346ebe7a3f53056ee6837f9f928d">unprocessed_rcds</a>.<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a> == <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a> || d-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a987fed78e6be6e293938b2a5f5de5ab8">processed_rcds</a>.<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a> == <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        || d-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a3b9e5d3a9658a6a92596f38a866496d0">buffered_app_data</a>.<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a> == <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>) {</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        <a class="code" href="pqueue_8c.html#a1c9b81e4391977030b98cc7e3c36aaf2">pqueue_free</a>(d-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a3b9c346ebe7a3f53056ee6837f9f928d">unprocessed_rcds</a>.<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a>);</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        <a class="code" href="pqueue_8c.html#a1c9b81e4391977030b98cc7e3c36aaf2">pqueue_free</a>(d-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a987fed78e6be6e293938b2a5f5de5ab8">processed_rcds</a>.<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a>);</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        <a class="code" href="pqueue_8c.html#a1c9b81e4391977030b98cc7e3c36aaf2">pqueue_free</a>(d-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a3b9e5d3a9658a6a92596f38a866496d0">buffered_app_data</a>.<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a>);</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(d);</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        rl-&gt;<a class="code" href="structRECORD__LAYER.html#ab791e525d7d88c4e178d69a01f41b3a8">d</a> = <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        <span class="keywordflow">return</span> (0);</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    }</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;}</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="record_8h.html#a6a3e98d5babadd66395c5ee66c3b8c51">   45</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="rec__layer__d1_8c.html#a6a3e98d5babadd66395c5ee66c3b8c51">DTLS_RECORD_LAYER_free</a>(<a class="code" href="structRECORD__LAYER.html">RECORD_LAYER</a> *rl)</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;{</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="rec__layer__d1_8c.html#aaa9f6b1c214407dc9dd22000b06f9296">DTLS_RECORD_LAYER_clear</a>(rl);</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="pqueue_8c.html#a1c9b81e4391977030b98cc7e3c36aaf2">pqueue_free</a>(rl-&gt;<a class="code" href="structRECORD__LAYER.html#ab791e525d7d88c4e178d69a01f41b3a8">d</a>-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a3b9c346ebe7a3f53056ee6837f9f928d">unprocessed_rcds</a>.<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a>);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="pqueue_8c.html#a1c9b81e4391977030b98cc7e3c36aaf2">pqueue_free</a>(rl-&gt;<a class="code" href="structRECORD__LAYER.html#ab791e525d7d88c4e178d69a01f41b3a8">d</a>-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a987fed78e6be6e293938b2a5f5de5ab8">processed_rcds</a>.<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a>);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="pqueue_8c.html#a1c9b81e4391977030b98cc7e3c36aaf2">pqueue_free</a>(rl-&gt;<a class="code" href="structRECORD__LAYER.html#ab791e525d7d88c4e178d69a01f41b3a8">d</a>-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a3b9e5d3a9658a6a92596f38a866496d0">buffered_app_data</a>.<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a>);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(rl-&gt;<a class="code" href="structRECORD__LAYER.html#ab791e525d7d88c4e178d69a01f41b3a8">d</a>);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    rl-&gt;<a class="code" href="structRECORD__LAYER.html#ab791e525d7d88c4e178d69a01f41b3a8">d</a> = <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;}</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="record_8h.html#aaa9f6b1c214407dc9dd22000b06f9296">   55</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="rec__layer__d1_8c.html#aaa9f6b1c214407dc9dd22000b06f9296">DTLS_RECORD_LAYER_clear</a>(<a class="code" href="structRECORD__LAYER.html">RECORD_LAYER</a> *rl)</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;{</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <a class="code" href="structDTLS__RECORD__LAYER.html">DTLS_RECORD_LAYER</a> *d;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    pitem *item = <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <a class="code" href="structDTLS1__RECORD__DATA.html">DTLS1_RECORD_DATA</a> *rdata;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    pqueue *unprocessed_rcds;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    pqueue *processed_rcds;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    pqueue *buffered_app_data;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    d = rl-&gt;<a class="code" href="structRECORD__LAYER.html#ab791e525d7d88c4e178d69a01f41b3a8">d</a>;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">while</span> ((item = <a class="code" href="pqueue_8c.html#ad6fd7f4360dedd4ae047f205dee7e1d2">pqueue_pop</a>(d-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a3b9c346ebe7a3f53056ee6837f9f928d">unprocessed_rcds</a>.<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a>)) != <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>) {</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        rdata = (<a class="code" href="structDTLS1__RECORD__DATA.html">DTLS1_RECORD_DATA</a> *)item-&gt;data;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(rdata-&gt;<a class="code" href="structDTLS1__RECORD__DATA.html#a9a1d2af51256a2a27b1b5b12d3b8e6ee">rbuf</a>.<a class="code" href="structSSL3__BUFFER.html#ac8ed9b9edf72a0bbde1ba01f0c67ef73">buf</a>);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(item-&gt;data);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <a class="code" href="pqueue_8c.html#aaf7c05ae52d91d8936012d52f58b584f">pitem_free</a>(item);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    }</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordflow">while</span> ((item = <a class="code" href="pqueue_8c.html#ad6fd7f4360dedd4ae047f205dee7e1d2">pqueue_pop</a>(d-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a987fed78e6be6e293938b2a5f5de5ab8">processed_rcds</a>.<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a>)) != <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>) {</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        rdata = (<a class="code" href="structDTLS1__RECORD__DATA.html">DTLS1_RECORD_DATA</a> *)item-&gt;data;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(rdata-&gt;<a class="code" href="structDTLS1__RECORD__DATA.html#a9a1d2af51256a2a27b1b5b12d3b8e6ee">rbuf</a>.<a class="code" href="structSSL3__BUFFER.html#ac8ed9b9edf72a0bbde1ba01f0c67ef73">buf</a>);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(item-&gt;data);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <a class="code" href="pqueue_8c.html#aaf7c05ae52d91d8936012d52f58b584f">pitem_free</a>(item);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    }</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keywordflow">while</span> ((item = <a class="code" href="pqueue_8c.html#ad6fd7f4360dedd4ae047f205dee7e1d2">pqueue_pop</a>(d-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a3b9e5d3a9658a6a92596f38a866496d0">buffered_app_data</a>.<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a>)) != <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>) {</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        rdata = (<a class="code" href="structDTLS1__RECORD__DATA.html">DTLS1_RECORD_DATA</a> *)item-&gt;data;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(rdata-&gt;<a class="code" href="structDTLS1__RECORD__DATA.html#a9a1d2af51256a2a27b1b5b12d3b8e6ee">rbuf</a>.<a class="code" href="structSSL3__BUFFER.html#ac8ed9b9edf72a0bbde1ba01f0c67ef73">buf</a>);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(item-&gt;data);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <a class="code" href="pqueue_8c.html#aaf7c05ae52d91d8936012d52f58b584f">pitem_free</a>(item);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    }</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    unprocessed_rcds = d-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a3b9c346ebe7a3f53056ee6837f9f928d">unprocessed_rcds</a>.<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a>;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    processed_rcds = d-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a987fed78e6be6e293938b2a5f5de5ab8">processed_rcds</a>.<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a>;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    buffered_app_data = d-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a3b9e5d3a9658a6a92596f38a866496d0">buffered_app_data</a>.<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a>;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    memset(d, 0, <span class="keyword">sizeof</span>(*d));</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    d-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a3b9c346ebe7a3f53056ee6837f9f928d">unprocessed_rcds</a>.<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a> = unprocessed_rcds;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    d-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a987fed78e6be6e293938b2a5f5de5ab8">processed_rcds</a>.<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a> = processed_rcds;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    d-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a3b9e5d3a9658a6a92596f38a866496d0">buffered_app_data</a>.<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a> = buffered_app_data;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;}</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="record_8h.html#afe163a60c037dffc406a999cdf4d733f">   96</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="rec__layer__d1_8c.html#afe163a60c037dffc406a999cdf4d733f">DTLS_RECORD_LAYER_set_saved_w_epoch</a>(<a class="code" href="structRECORD__LAYER.html">RECORD_LAYER</a> *rl, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="rsa_8h.html#a97173d49d4425d6ba54508bfe352412b">e</a>)</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;{</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordflow">if</span> (e == rl-&gt;<a class="code" href="structRECORD__LAYER.html#ab791e525d7d88c4e178d69a01f41b3a8">d</a>-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a07f814f5c84eeeb5692055b2ca77bc02">w_epoch</a> - 1) {</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        memcpy(rl-&gt;<a class="code" href="structRECORD__LAYER.html#ab791e525d7d88c4e178d69a01f41b3a8">d</a>-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#ac9de66909d66b507bdcb6ea5092f4b8f">curr_write_sequence</a>,</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;               rl-&gt;<a class="code" href="structRECORD__LAYER.html#a773db95eb941ace70687563ac7737dd9">write_sequence</a>, <span class="keyword">sizeof</span>(rl-&gt;<a class="code" href="structRECORD__LAYER.html#a773db95eb941ace70687563ac7737dd9">write_sequence</a>));</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        memcpy(rl-&gt;<a class="code" href="structRECORD__LAYER.html#a773db95eb941ace70687563ac7737dd9">write_sequence</a>,</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;               rl-&gt;<a class="code" href="structRECORD__LAYER.html#ab791e525d7d88c4e178d69a01f41b3a8">d</a>-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#ac832ab1321fbf5ec9652cde74cbef3ae">last_write_sequence</a>, <span class="keyword">sizeof</span>(rl-&gt;<a class="code" href="structRECORD__LAYER.html#a773db95eb941ace70687563ac7737dd9">write_sequence</a>));</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e == rl-&gt;<a class="code" href="structRECORD__LAYER.html#ab791e525d7d88c4e178d69a01f41b3a8">d</a>-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a07f814f5c84eeeb5692055b2ca77bc02">w_epoch</a> + 1) {</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        memcpy(rl-&gt;<a class="code" href="structRECORD__LAYER.html#ab791e525d7d88c4e178d69a01f41b3a8">d</a>-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#ac832ab1321fbf5ec9652cde74cbef3ae">last_write_sequence</a>,</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;               rl-&gt;<a class="code" href="structRECORD__LAYER.html#a773db95eb941ace70687563ac7737dd9">write_sequence</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[8]));</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        memcpy(rl-&gt;<a class="code" href="structRECORD__LAYER.html#a773db95eb941ace70687563ac7737dd9">write_sequence</a>,</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;               rl-&gt;<a class="code" href="structRECORD__LAYER.html#ab791e525d7d88c4e178d69a01f41b3a8">d</a>-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#ac9de66909d66b507bdcb6ea5092f4b8f">curr_write_sequence</a>, <span class="keyword">sizeof</span>(rl-&gt;<a class="code" href="structRECORD__LAYER.html#a773db95eb941ace70687563ac7737dd9">write_sequence</a>));</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    }</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    rl-&gt;<a class="code" href="structRECORD__LAYER.html#ab791e525d7d88c4e178d69a01f41b3a8">d</a>-&gt;<a class="code" href="structDTLS__RECORD__LAYER.html#a07f814f5c84eeeb5692055b2ca77bc02">w_epoch</a> = <a class="code" href="rsa_8h.html#a97173d49d4425d6ba54508bfe352412b">e</a>;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;}</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="record_8h.html#a7c4b07a1bdd29b9312d564597157f27e">  112</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="rec__layer__d1_8c.html#a7c4b07a1bdd29b9312d564597157f27e">DTLS_RECORD_LAYER_resync_write</a>(<a class="code" href="structRECORD__LAYER.html">RECORD_LAYER</a> *rl)</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;{</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    memcpy(rl-&gt;<a class="code" href="structRECORD__LAYER.html#a773db95eb941ace70687563ac7737dd9">write_sequence</a>, rl-&gt;<a class="code" href="structRECORD__LAYER.html#a461df8119f9656fe77d397cee53ee0c4">read_sequence</a>, <span class="keyword">sizeof</span>(rl-&gt;<a class="code" href="structRECORD__LAYER.html#a773db95eb941ace70687563ac7737dd9">write_sequence</a>));</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;}</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="record_8h.html#a8a4b0d98035960d83b7ce1eca37b1dd6">  117</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="rec__layer__d1_8c.html#a8a4b0d98035960d83b7ce1eca37b1dd6">DTLS_RECORD_LAYER_set_write_sequence</a>(<a class="code" href="structRECORD__LAYER.html">RECORD_LAYER</a> *rl, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="bad__dtls__test_8c.html#a189930c4babdc38135a74db479534069">seq</a>)</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;{</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    memcpy(rl-&gt;<a class="code" href="structRECORD__LAYER.html#a773db95eb941ace70687563ac7737dd9">write_sequence</a>, seq, <a class="code" href="record_8h.html#ace5daf28516639bf2395ae48b5f6ba95">SEQ_NUM_SIZE</a>);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;}</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="keyword">static</span> <span class="keywordtype">size_t</span> have_handshake_fragment(SSL *s, <span class="keywordtype">int</span> <a class="code" href="e__aes_8c.html#ab512b8f495325c7ea0f5a5a5d3f938eb">type</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf,</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                                      <span class="keywordtype">size_t</span> <a class="code" href="ct_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">/* copy buffered record into SSL structure */</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> dtls1_copy_record(SSL *s, pitem *item)</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;{</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <a class="code" href="structDTLS1__RECORD__DATA.html">DTLS1_RECORD_DATA</a> *rdata;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    rdata = (<a class="code" href="structDTLS1__RECORD__DATA.html">DTLS1_RECORD_DATA</a> *)item-&gt;data;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="record__locl_8h.html#a3bc732da7a4862bbe72cf436f28643e1">SSL3_BUFFER_release</a>(&amp;s-&gt;rlayer.rbuf);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    s-&gt;rlayer.packet = rdata-&gt;<a class="code" href="structDTLS1__RECORD__DATA.html#a12f869e80da40cc0807ed2dddd5ff95e">packet</a>;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    s-&gt;rlayer.packet_length = rdata-&gt;<a class="code" href="structDTLS1__RECORD__DATA.html#acfd653e19cfeea50b4743edd7245df88">packet_length</a>;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    memcpy(&amp;s-&gt;rlayer.rbuf, &amp;(rdata-&gt;<a class="code" href="structDTLS1__RECORD__DATA.html#a9a1d2af51256a2a27b1b5b12d3b8e6ee">rbuf</a>), <span class="keyword">sizeof</span>(<a class="code" href="structSSL3__BUFFER.html">SSL3_BUFFER</a>));</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    memcpy(&amp;s-&gt;rlayer.rrec, &amp;(rdata-&gt;<a class="code" href="structDTLS1__RECORD__DATA.html#a4f4654e61a104fc84503bb658507d673">rrec</a>), <span class="keyword">sizeof</span>(<a class="code" href="structSSL3__RECORD.html">SSL3_RECORD</a>));</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">/* Set proper sequence number for mac calculation */</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    memcpy(&amp;(s-&gt;rlayer.read_sequence[2]), &amp;(rdata-&gt;<a class="code" href="structDTLS1__RECORD__DATA.html#a12f869e80da40cc0807ed2dddd5ff95e">packet</a>[5]), 6);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">return</span> (1);</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;}</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno"><a class="line" href="record__locl_8h.html#aeeff7210b2ca8c216d73471154de504e">  145</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="rec__layer__d1_8c.html#a900d0426fe39d6d554769c25bb57ff7b">dtls1_buffer_record</a>(SSL *s, <a class="code" href="structrecord__pqueue.html">record_pqueue</a> *queue, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *priority)</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;{</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <a class="code" href="structDTLS1__RECORD__DATA.html">DTLS1_RECORD_DATA</a> *rdata;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    pitem *item;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">/* Limit the size of the queue to prevent DOS attacks */</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="pqueue_8c.html#aa637ea716e3bb8c38115dcbe5c84f11b">pqueue_size</a>(queue-&gt;<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a>) &gt;= 100)</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    rdata = <a class="code" href="crypto_8h.html#afdb80d14aed3b15d0ef71f72a872310d">OPENSSL_malloc</a>(<span class="keyword">sizeof</span>(*rdata));</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    item = <a class="code" href="pqueue_8c.html#a9cf666037bccc254a6799b9f65ad663b">pitem_new</a>(priority, rdata);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordflow">if</span> (rdata == <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a> || item == <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>) {</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(rdata);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <a class="code" href="pqueue_8c.html#aaf7c05ae52d91d8936012d52f58b584f">pitem_free</a>(item);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <a class="code" href="openssl_2err_8h.html#a85650ea112d3012313596df1cb1b7760">SSLerr</a>(<a class="code" href="ssl_8h.html#a539e12043296c284530cd83ca682298e">SSL_F_DTLS1_BUFFER_RECORD</a>, <a class="code" href="openssl_2err_8h.html#ac863d0e29abbb6c480be6983fd48bf42">ERR_R_INTERNAL_ERROR</a>);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    }</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    rdata-&gt;<a class="code" href="structDTLS1__RECORD__DATA.html#a12f869e80da40cc0807ed2dddd5ff95e">packet</a> = s-&gt;rlayer.packet;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    rdata-&gt;<a class="code" href="structDTLS1__RECORD__DATA.html#acfd653e19cfeea50b4743edd7245df88">packet_length</a> = s-&gt;rlayer.packet_length;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    memcpy(&amp;(rdata-&gt;<a class="code" href="structDTLS1__RECORD__DATA.html#a9a1d2af51256a2a27b1b5b12d3b8e6ee">rbuf</a>), &amp;s-&gt;rlayer.rbuf, <span class="keyword">sizeof</span>(<a class="code" href="structSSL3__BUFFER.html">SSL3_BUFFER</a>));</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    memcpy(&amp;(rdata-&gt;<a class="code" href="structDTLS1__RECORD__DATA.html#a4f4654e61a104fc84503bb658507d673">rrec</a>), &amp;s-&gt;rlayer.rrec, <span class="keyword">sizeof</span>(<a class="code" href="structSSL3__RECORD.html">SSL3_RECORD</a>));</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    item-&gt;data = rdata;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="preprocessor">#ifndef OPENSSL_NO_SCTP</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">/* Store bio_dgram_sctp_rcvinfo struct */</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bss__dgram_8c.html#a1f335fa8b46ddcdfc52cf260781363f9">BIO_dgram_is_sctp</a>(<a class="code" href="ssl_8h.html#ade818ef4efdc44c84043909e4b466d3b">SSL_get_rbio</a>(s)) &amp;&amp;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        (<a class="code" href="ssl_8h.html#aece45de10e6d3afe21bd0ec3bc49f100">SSL_get_state</a>(s) == <a class="code" href="ssl_8h.html#a6fb6d4c2fc1439c2f4bea7153cfcc28ba574295aa19d4135564cad6aea13df3a4">TLS_ST_SR_FINISHED</a></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;         || <a class="code" href="ssl_8h.html#aece45de10e6d3afe21bd0ec3bc49f100">SSL_get_state</a>(s) == <a class="code" href="ssl_8h.html#a6fb6d4c2fc1439c2f4bea7153cfcc28bac9a4fca741223aadce221eb5c581146b">TLS_ST_CR_FINISHED</a>)) {</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <a class="code" href="bio__lib_8c.html#af91d25b1b326df959b3b5d05a1891577">BIO_ctrl</a>(<a class="code" href="ssl_8h.html#ade818ef4efdc44c84043909e4b466d3b">SSL_get_rbio</a>(s), <a class="code" href="openssl_2bio_8h.html#ab5e0136b62a0730d3f9b27c9d74c8ddc">BIO_CTRL_DGRAM_SCTP_GET_RCVINFO</a>,</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                 <span class="keyword">sizeof</span>(rdata-&gt;<a class="code" href="structDTLS1__RECORD__DATA.html#a0089d43b7c64e871febcfe7a79ce286d">recordinfo</a>), &amp;rdata-&gt;<a class="code" href="structDTLS1__RECORD__DATA.html#a0089d43b7c64e871febcfe7a79ce286d">recordinfo</a>);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    s-&gt;rlayer.packet = <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    s-&gt;rlayer.packet_length = 0;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    memset(&amp;s-&gt;rlayer.rbuf, 0, <span class="keyword">sizeof</span>(s-&gt;rlayer.rbuf));</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    memset(&amp;s-&gt;rlayer.rrec, 0, <span class="keyword">sizeof</span>(s-&gt;rlayer.rrec));</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="record_8h.html#ade107ee5ac6b568af03b2475139041b0">ssl3_setup_buffers</a>(s)) {</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <a class="code" href="openssl_2err_8h.html#a85650ea112d3012313596df1cb1b7760">SSLerr</a>(<a class="code" href="ssl_8h.html#a539e12043296c284530cd83ca682298e">SSL_F_DTLS1_BUFFER_RECORD</a>, <a class="code" href="openssl_2err_8h.html#ac863d0e29abbb6c480be6983fd48bf42">ERR_R_INTERNAL_ERROR</a>);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(rdata-&gt;<a class="code" href="structDTLS1__RECORD__DATA.html#a9a1d2af51256a2a27b1b5b12d3b8e6ee">rbuf</a>.<a class="code" href="structSSL3__BUFFER.html#ac8ed9b9edf72a0bbde1ba01f0c67ef73">buf</a>);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(rdata);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <a class="code" href="pqueue_8c.html#aaf7c05ae52d91d8936012d52f58b584f">pitem_free</a>(item);</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordflow">return</span> (-1);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    }</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">/* insert should not fail, since duplicates are dropped */</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="pqueue_8c.html#a3af216a259925f97503fb0f60a153899">pqueue_insert</a>(queue-&gt;<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a>, item) == <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>) {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <a class="code" href="openssl_2err_8h.html#a85650ea112d3012313596df1cb1b7760">SSLerr</a>(<a class="code" href="ssl_8h.html#a539e12043296c284530cd83ca682298e">SSL_F_DTLS1_BUFFER_RECORD</a>, <a class="code" href="openssl_2err_8h.html#ac863d0e29abbb6c480be6983fd48bf42">ERR_R_INTERNAL_ERROR</a>);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(rdata-&gt;<a class="code" href="structDTLS1__RECORD__DATA.html#a9a1d2af51256a2a27b1b5b12d3b8e6ee">rbuf</a>.<a class="code" href="structSSL3__BUFFER.html#ac8ed9b9edf72a0bbde1ba01f0c67ef73">buf</a>);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(rdata);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <a class="code" href="pqueue_8c.html#aaf7c05ae52d91d8936012d52f58b584f">pitem_free</a>(item);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordflow">return</span> (-1);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    }</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">return</span> (1);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;}</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno"><a class="line" href="record__locl_8h.html#ae9f785f5e3a92a95508165321bd04ee6">  205</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="rec__layer__d1_8c.html#ae9f785f5e3a92a95508165321bd04ee6">dtls1_retrieve_buffered_record</a>(SSL *s, <a class="code" href="structrecord__pqueue.html">record_pqueue</a> *queue)</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;{</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    pitem *item;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    item = <a class="code" href="pqueue_8c.html#ad6fd7f4360dedd4ae047f205dee7e1d2">pqueue_pop</a>(queue-&gt;<a class="code" href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">q</a>);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordflow">if</span> (item) {</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        dtls1_copy_record(s, item);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(item-&gt;data);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <a class="code" href="pqueue_8c.html#aaf7c05ae52d91d8936012d52f58b584f">pitem_free</a>(item);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="keywordflow">return</span> (1);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    }</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">return</span> (0);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;}</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment"> * retrieve a buffered record that belongs to the new epoch, i.e., not</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment"> * processed yet</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00226"></a><span class="lineno"><a class="line" href="rec__layer__d1_8c.html#aba659edf920d1ee1322a269417c869bd">  226</a></span>&#160;<span class="preprocessor">#define dtls1_get_unprocessed_record(s) \</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="preprocessor">                   dtls1_retrieve_buffered_record((s), \</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="preprocessor">                   &amp;((s)-&gt;rlayer.d-&gt;unprocessed_rcds))</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno"><a class="line" href="record__locl_8h.html#a152e40dd2a65f190a77801a5fbe5544f">  230</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="rec__layer__d1_8c.html#a152e40dd2a65f190a77801a5fbe5544f">dtls1_process_buffered_records</a>(SSL *s)</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;{</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    pitem *item;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <a class="code" href="structSSL3__BUFFER.html">SSL3_BUFFER</a> *rb;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <a class="code" href="structSSL3__RECORD.html">SSL3_RECORD</a> *rr;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <a class="code" href="structDTLS1__BITMAP.html">DTLS1_BITMAP</a> *bitmap;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> is_next_epoch;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordtype">int</span> replayok = 1;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    item = <a class="code" href="pqueue_8c.html#a7bf585ee203902b922fdda8a49e80f8d">pqueue_peek</a>(s-&gt;rlayer.d-&gt;unprocessed_rcds.q);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">if</span> (item) {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <span class="comment">/* Check if epoch is current. */</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="keywordflow">if</span> (s-&gt;rlayer.d-&gt;unprocessed_rcds.epoch != s-&gt;rlayer.d-&gt;r_epoch)</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            <span class="keywordflow">return</span> 1;         <span class="comment">/* Nothing to do. */</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        rr = <a class="code" href="record__locl_8h.html#afb43c2a006def3dac987d320cd6edb57">RECORD_LAYER_get_rrec</a>(&amp;s-&gt;rlayer);</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        rb = <a class="code" href="record__locl_8h.html#a2ed0d41ecc44677103540cc5ab800b63">RECORD_LAYER_get_rbuf</a>(&amp;s-&gt;rlayer);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="record__locl_8h.html#a8a8fa930ff9d5578c68f31001fcdd765">SSL3_BUFFER_get_left</a>(rb) &gt; 0) {</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">             * We&#39;ve still got data from the current packet to read. There could</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">             * be a record from the new epoch in it - so don&#39;t overwrite it</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">             * with the unprocessed records yet (we&#39;ll do it when we&#39;ve</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">             * finished reading the current packet).</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="comment">/* Process all the records. */</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="keywordflow">while</span> (<a class="code" href="pqueue_8c.html#a7bf585ee203902b922fdda8a49e80f8d">pqueue_peek</a>(s-&gt;rlayer.d-&gt;unprocessed_rcds.q)) {</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            <a class="code" href="rec__layer__d1_8c.html#aba659edf920d1ee1322a269417c869bd">dtls1_get_unprocessed_record</a>(s);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            bitmap = <a class="code" href="rec__layer__d1_8c.html#a8a7e26d5d3fc9399cdaaebb051c51d15">dtls1_get_bitmap</a>(s, rr, &amp;is_next_epoch);</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            <span class="keywordflow">if</span> (bitmap == <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>) {</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                <span class="comment">/*</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">                 * Should not happen. This will only ever be NULL when the</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">                 * current record is from a different epoch. But that cannot</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">                 * be the case because we already checked the epoch above</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">                 */</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                 <a class="code" href="openssl_2err_8h.html#a85650ea112d3012313596df1cb1b7760">SSLerr</a>(<a class="code" href="ssl_8h.html#a1e7792c666f6445d5e67a561068b1b44">SSL_F_DTLS1_PROCESS_BUFFERED_RECORDS</a>,</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                        <a class="code" href="openssl_2err_8h.html#ac863d0e29abbb6c480be6983fd48bf42">ERR_R_INTERNAL_ERROR</a>);</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                 <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            }</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="preprocessor">#ifndef OPENSSL_NO_SCTP</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            <span class="comment">/* Only do replay check if no SCTP bio */</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="bss__dgram_8c.html#a1f335fa8b46ddcdfc52cf260781363f9">BIO_dgram_is_sctp</a>(<a class="code" href="ssl_8h.html#ade818ef4efdc44c84043909e4b466d3b">SSL_get_rbio</a>(s)))</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            {</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                <span class="comment">/*</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">                 * Check whether this is a repeat, or aged record. We did this</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">                 * check once already when we first received the record - but</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">                 * we might have updated the window since then due to</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">                 * records we subsequently processed.</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">                 */</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                replayok = <a class="code" href="dtls1__bitmap_8c.html#a48f1bf809e7ba5db6a2048f4976d93eb">dtls1_record_replay_check</a>(s, bitmap);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            }</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            <span class="keywordflow">if</span> (!replayok || !<a class="code" href="record__locl_8h.html#a39fe92cc44402695055256f15008bde9">dtls1_process_record</a>(s, bitmap)) {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                <span class="comment">/* dump this record */</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                rr-&gt;<a class="code" href="structSSL3__RECORD.html#ae809d5359ac030c60a30a8f0b2294b82">length</a> = 0;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                <a class="code" href="record__locl_8h.html#ab587c0e5dba08b9af1113b72878078c5">RECORD_LAYER_reset_packet_length</a>(&amp;s-&gt;rlayer);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            }</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="rec__layer__d1_8c.html#a900d0426fe39d6d554769c25bb57ff7b">dtls1_buffer_record</a>(s, &amp;(s-&gt;rlayer.d-&gt;processed_rcds),</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                    <a class="code" href="record__locl_8h.html#a26746fe96958cdc75ea4ac63bd3ede39">SSL3_RECORD_get_seq_num</a>(s-&gt;rlayer.rrec)) &lt; 0)</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        }</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    }</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">     * sync epoch numbers once all the unprocessed records have been</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">     * processed</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    s-&gt;rlayer.d-&gt;processed_rcds.epoch = s-&gt;rlayer.d-&gt;r_epoch;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    s-&gt;rlayer.d-&gt;unprocessed_rcds.epoch = s-&gt;rlayer.d-&gt;r_epoch + 1;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;}</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">/*-</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment"> * Return up to &#39;len&#39; payload bytes received in &#39;type&#39; records.</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment"> * &#39;type&#39; is one of the following:</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment"> *   -  SSL3_RT_HANDSHAKE (when ssl3_get_message calls us)</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment"> *   -  SSL3_RT_APPLICATION_DATA (when ssl3_read calls us)</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment"> *   -  0 (during a shutdown, no data has to be returned)</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment"> * If we don&#39;t have stored data to work from, read a SSL/TLS record first</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment"> * (possibly multiple records if we still don&#39;t have anything to return).</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment"> * This function must handle any surprises the peer may have for us, such as</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment"> * Alert records (e.g. close_notify) or renegotiation requests. ChangeCipherSpec</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment"> * messages are treated as if they were handshake messages *if* the |recd_type|</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment"> * argument is non NULL.</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment"> * Also if record payloads contain fragments too small to process, we store</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment"> * them until there is enough for the respective protocol (the record protocol</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment"> * may use arbitrary fragmentation and even interleaving):</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment"> *     Change cipher spec protocol</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment"> *             just 1 byte needed, no need for keeping anything stored</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment"> *     Alert protocol</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment"> *             2 bytes needed (AlertLevel, AlertDescription)</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment"> *     Handshake protocol</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment"> *             4 bytes needed (HandshakeType, uint24 length) -- we just have</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment"> *             to detect unexpected Client Hello and Hello Request messages</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment"> *             here, anything else is handled by higher layers</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment"> *     Application data protocol</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment"> *             none of our business</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00339"></a><span class="lineno"><a class="line" href="record_8h.html#a3b4d70c143cfc8c0f37f71842c2c90ee">  339</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="rec__layer__d1_8c.html#a156a06924635389532145a5e5db18a95">dtls1_read_bytes</a>(SSL *s, <span class="keywordtype">int</span> <a class="code" href="e__aes_8c.html#ab512b8f495325c7ea0f5a5a5d3f938eb">type</a>, <span class="keywordtype">int</span> *recvd_type, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf,</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                     <span class="keywordtype">size_t</span> <a class="code" href="ct_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>, <span class="keywordtype">int</span> peek, <span class="keywordtype">size_t</span> *readbytes)</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;{</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordtype">int</span> al, i, j, iret;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordtype">size_t</span> ret, n;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <a class="code" href="structSSL3__RECORD.html">SSL3_RECORD</a> *rr;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    void (*<a class="code" href="bn_8h.html#a3440f8540faaec9c34da16295933680d">cb</a>) (<span class="keyword">const</span> SSL *ssl, <span class="keywordtype">int</span> type2, <span class="keywordtype">int</span> val) = <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="record__locl_8h.html#a493142fdfb3ea2f1b7417c057790d623">SSL3_BUFFER_is_initialised</a>(&amp;s-&gt;rlayer.rbuf)) {</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="comment">/* Not initialized yet */</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="record_8h.html#ade107ee5ac6b568af03b2475139041b0">ssl3_setup_buffers</a>(s))</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            <span class="keywordflow">return</span> (-1);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    }</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">if</span> ((type &amp;&amp; (type != <a class="code" href="ssl3_8h.html#a96e6f315f7fe97caf2634fb434700e25">SSL3_RT_APPLICATION_DATA</a>) &amp;&amp;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;         (type != <a class="code" href="ssl3_8h.html#a913c4ab23166cbc9b67d6f759f7c87e5">SSL3_RT_HANDSHAKE</a>)) ||</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        (peek &amp;&amp; (type != <a class="code" href="ssl3_8h.html#a96e6f315f7fe97caf2634fb434700e25">SSL3_RT_APPLICATION_DATA</a>))) {</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <a class="code" href="openssl_2err_8h.html#a85650ea112d3012313596df1cb1b7760">SSLerr</a>(<a class="code" href="ssl_8h.html#ad5ba194c84ab706f94cde94d02296ff3">SSL_F_DTLS1_READ_BYTES</a>, <a class="code" href="openssl_2err_8h.html#ac863d0e29abbb6c480be6983fd48bf42">ERR_R_INTERNAL_ERROR</a>);</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    }</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">     * check whether there&#39;s a handshake message (client hello?) waiting</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    ret = have_handshake_fragment(s, type, buf, len);</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">if</span> (ret &gt; 0) {</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        *recvd_type = <a class="code" href="ssl3_8h.html#a913c4ab23166cbc9b67d6f759f7c87e5">SSL3_RT_HANDSHAKE</a>;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        *readbytes = ret;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    }</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">     * Now s-&gt;rlayer.d-&gt;handshake_fragment_len == 0 if</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">     * type == SSL3_RT_HANDSHAKE.</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="preprocessor">#ifndef OPENSSL_NO_SCTP</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">     * Continue handshake if it had to be interrupted to read app data with</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">     * SCTP.</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordflow">if</span> ((!<a class="code" href="statem_8c.html#a21ec74f54ef5c0f0543304b2ec35f762">ossl_statem_get_in_handshake</a>(s) &amp;&amp; <a class="code" href="ssl_8h.html#a8bcb06e82fc1107090412d76163045f5">SSL_in_init</a>(s)) ||</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        (<a class="code" href="bss__dgram_8c.html#a1f335fa8b46ddcdfc52cf260781363f9">BIO_dgram_is_sctp</a>(<a class="code" href="ssl_8h.html#ade818ef4efdc44c84043909e4b466d3b">SSL_get_rbio</a>(s))</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;         &amp;&amp; <a class="code" href="statem_8c.html#adb23f211302fad874f72e889ee0cf2b3">ossl_statem_in_sctp_read_sock</a>(s)</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;         &amp;&amp; s-&gt;s3-&gt;in_read_app_data != 2))</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="statem_8c.html#a21ec74f54ef5c0f0543304b2ec35f762">ossl_statem_get_in_handshake</a>(s) &amp;&amp; <a class="code" href="ssl_8h.html#a8bcb06e82fc1107090412d76163045f5">SSL_in_init</a>(s))</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    {</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="comment">/* type == SSL3_RT_APPLICATION_DATA */</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        i = s-&gt;handshake_func(s);</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="keywordflow">if</span> (i &lt; 0)</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            <span class="keywordflow">return</span> i;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="keywordflow">if</span> (i == 0) {</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            <a class="code" href="openssl_2err_8h.html#a85650ea112d3012313596df1cb1b7760">SSLerr</a>(<a class="code" href="ssl_8h.html#ad5ba194c84ab706f94cde94d02296ff3">SSL_F_DTLS1_READ_BYTES</a>, <a class="code" href="ssl_8h.html#a0670a14fbc4206622336d9cea3bb03f7">SSL_R_SSL_HANDSHAKE_FAILURE</a>);</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        }</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    }</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; start:</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    s-&gt;rwstate = <a class="code" href="ssl_8h.html#a620f769f6a2c309539b068dd2c079442">SSL_NOTHING</a>;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="comment">/*-</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">     * s-&gt;s3-&gt;rrec.type         - is the type of record</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">     * s-&gt;s3-&gt;rrec.data,    - data</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">     * s-&gt;s3-&gt;rrec.off,     - offset into &#39;data&#39; for next read</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">     * s-&gt;s3-&gt;rrec.length,  - number of bytes.</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    rr = s-&gt;rlayer.rrec;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">     * We are not handshaking and have no data yet, so process data buffered</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">     * during the last handshake in advance, if any.</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ssl_8h.html#afd5c90111dbeeb7667a62bbdf8337d98">SSL_is_init_finished</a>(s) &amp;&amp; <a class="code" href="record__locl_8h.html#a02cd8809c77bc3d39ef83db867463c82">SSL3_RECORD_get_length</a>(rr) == 0) {</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        pitem *item;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        item = <a class="code" href="pqueue_8c.html#ad6fd7f4360dedd4ae047f205dee7e1d2">pqueue_pop</a>(s-&gt;rlayer.d-&gt;buffered_app_data.q);</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <span class="keywordflow">if</span> (item) {</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="preprocessor">#ifndef OPENSSL_NO_SCTP</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            <span class="comment">/* Restore bio_dgram_sctp_rcvinfo struct */</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="bss__dgram_8c.html#a1f335fa8b46ddcdfc52cf260781363f9">BIO_dgram_is_sctp</a>(<a class="code" href="ssl_8h.html#ade818ef4efdc44c84043909e4b466d3b">SSL_get_rbio</a>(s))) {</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                <a class="code" href="structDTLS1__RECORD__DATA.html">DTLS1_RECORD_DATA</a> *rdata = (<a class="code" href="structDTLS1__RECORD__DATA.html">DTLS1_RECORD_DATA</a> *)item-&gt;data;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                <a class="code" href="bio__lib_8c.html#af91d25b1b326df959b3b5d05a1891577">BIO_ctrl</a>(<a class="code" href="ssl_8h.html#ade818ef4efdc44c84043909e4b466d3b">SSL_get_rbio</a>(s), <a class="code" href="openssl_2bio_8h.html#a46f7810f041c1d804d87bb073dccc45f">BIO_CTRL_DGRAM_SCTP_SET_RCVINFO</a>,</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                         <span class="keyword">sizeof</span>(rdata-&gt;<a class="code" href="structDTLS1__RECORD__DATA.html#a0089d43b7c64e871febcfe7a79ce286d">recordinfo</a>), &amp;rdata-&gt;<a class="code" href="structDTLS1__RECORD__DATA.html#a0089d43b7c64e871febcfe7a79ce286d">recordinfo</a>);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            }</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            dtls1_copy_record(s, item);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(item-&gt;data);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            <a class="code" href="pqueue_8c.html#aaf7c05ae52d91d8936012d52f58b584f">pitem_free</a>(item);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        }</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    }</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="comment">/* Check for timeout */</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="d1__lib_8c.html#ae9ef4caa95d87180cd12359f2c62f4d5">dtls1_handle_timeout</a>(s) &gt; 0)</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="comment">/* get new packet if necessary */</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="record__locl_8h.html#a02cd8809c77bc3d39ef83db867463c82">SSL3_RECORD_get_length</a>(rr) == 0)</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        || (s-&gt;rlayer.rstate == <a class="code" href="ssl_8h.html#a77d177dc7fea2e76174c3a3e3de6b39b">SSL_ST_READ_BODY</a>)) {</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        iret = <a class="code" href="record__locl_8h.html#a2d62c9700244c0c268c614b04bab75a2">dtls1_get_record</a>(s);</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="keywordflow">if</span> (iret &lt;= 0) {</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            iret = <a class="code" href="ssl__locl_8h.html#afe783848d7ab27160fb314a3934d8a1e">dtls1_read_failed</a>(s, iret);</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            <span class="comment">/* anything other than a timeout is an error */</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            <span class="keywordflow">if</span> (iret &lt;= 0)</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                <span class="keywordflow">return</span> iret;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        }</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    }</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment">     * Reset the count of consecutive warning alerts if we&#39;ve got a non-empty</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">     * record that isn&#39;t an alert.</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="record__locl_8h.html#a3ad663c2b589f8e007f99e3e402c330e">SSL3_RECORD_get_type</a>(rr) != <a class="code" href="ssl3_8h.html#ac2ed784b96ecdc1d92d805793dd8a14c">SSL3_RT_ALERT</a></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            &amp;&amp; <a class="code" href="record__locl_8h.html#a02cd8809c77bc3d39ef83db867463c82">SSL3_RECORD_get_length</a>(rr) != 0)</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        s-&gt;rlayer.alert_count = 0;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="comment">/* we now have a packet which can be read and processed */</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keywordflow">if</span> (s-&gt;s3-&gt;change_cipher_spec <span class="comment">/* set when we receive ChangeCipherSpec,</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">                                   * reset by ssl3_get_finished */</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        &amp;&amp; (<a class="code" href="record__locl_8h.html#a3ad663c2b589f8e007f99e3e402c330e">SSL3_RECORD_get_type</a>(rr) != <a class="code" href="ssl3_8h.html#a913c4ab23166cbc9b67d6f759f7c87e5">SSL3_RT_HANDSHAKE</a>)) {</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">         * We now have application data between CCS and Finished. Most likely</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">         * the packets were reordered on their way, so buffer the application</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">         * data for later processing rather than dropping the connection.</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="rec__layer__d1_8c.html#a900d0426fe39d6d554769c25bb57ff7b">dtls1_buffer_record</a>(s, &amp;(s-&gt;rlayer.d-&gt;buffered_app_data),</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                                <a class="code" href="record__locl_8h.html#a26746fe96958cdc75ea4ac63bd3ede39">SSL3_RECORD_get_seq_num</a>(rr)) &lt; 0) {</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            <a class="code" href="openssl_2err_8h.html#a85650ea112d3012313596df1cb1b7760">SSLerr</a>(<a class="code" href="ssl_8h.html#ad5ba194c84ab706f94cde94d02296ff3">SSL_F_DTLS1_READ_BYTES</a>, <a class="code" href="openssl_2err_8h.html#ac863d0e29abbb6c480be6983fd48bf42">ERR_R_INTERNAL_ERROR</a>);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        }</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        <a class="code" href="record__locl_8h.html#ab8fa0ea13a2529e8def561656f2f9d8e">SSL3_RECORD_set_length</a>(rr, 0);</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    }</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">     * If the other end has shut down, throw anything we read away (even in</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">     * &#39;peek&#39; mode)</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordflow">if</span> (s-&gt;shutdown &amp; <a class="code" href="ssl_8h.html#acc867649d6aac0f6cbea1ea8ff213a50">SSL_RECEIVED_SHUTDOWN</a>) {</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <a class="code" href="record__locl_8h.html#ab8fa0ea13a2529e8def561656f2f9d8e">SSL3_RECORD_set_length</a>(rr, 0);</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        s-&gt;rwstate = <a class="code" href="ssl_8h.html#a620f769f6a2c309539b068dd2c079442">SSL_NOTHING</a>;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    }</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordflow">if</span> (type == <a class="code" href="record__locl_8h.html#a3ad663c2b589f8e007f99e3e402c330e">SSL3_RECORD_get_type</a>(rr)</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        || (<a class="code" href="record__locl_8h.html#a3ad663c2b589f8e007f99e3e402c330e">SSL3_RECORD_get_type</a>(rr) == <a class="code" href="ssl3_8h.html#ae54807cec33243767b2d18ec1e4dc290">SSL3_RT_CHANGE_CIPHER_SPEC</a></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            &amp;&amp; type == <a class="code" href="ssl3_8h.html#a913c4ab23166cbc9b67d6f759f7c87e5">SSL3_RT_HANDSHAKE</a> &amp;&amp; recvd_type != <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>)) {</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">         * SSL3_RT_APPLICATION_DATA or</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment">         * SSL3_RT_HANDSHAKE or</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">         * SSL3_RT_CHANGE_CIPHER_SPEC</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">         * make sure that we are not getting application data when we are</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">         * doing a handshake for the first time</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="ssl_8h.html#a8bcb06e82fc1107090412d76163045f5">SSL_in_init</a>(s) &amp;&amp; (type == <a class="code" href="ssl3_8h.html#a96e6f315f7fe97caf2634fb434700e25">SSL3_RT_APPLICATION_DATA</a>) &amp;&amp;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            (s-&gt;enc_read_ctx == <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>)) {</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            al = <a class="code" href="ssl_8h.html#adda5f067eef1a4868484abb8fe45287e">SSL_AD_UNEXPECTED_MESSAGE</a>;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            <a class="code" href="openssl_2err_8h.html#a85650ea112d3012313596df1cb1b7760">SSLerr</a>(<a class="code" href="ssl_8h.html#ad5ba194c84ab706f94cde94d02296ff3">SSL_F_DTLS1_READ_BYTES</a>, <a class="code" href="ssl_8h.html#a8543e341fd503bc4bf3d1636af6634bf">SSL_R_APP_DATA_IN_HANDSHAKE</a>);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            <span class="keywordflow">goto</span> f_err;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="keywordflow">if</span> (recvd_type != <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>)</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            *recvd_type = <a class="code" href="record__locl_8h.html#a3ad663c2b589f8e007f99e3e402c330e">SSL3_RECORD_get_type</a>(rr);</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keywordflow">if</span> (len == 0)</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="keywordflow">if</span> (len &gt; <a class="code" href="record__locl_8h.html#a02cd8809c77bc3d39ef83db867463c82">SSL3_RECORD_get_length</a>(rr))</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            n = <a class="code" href="record__locl_8h.html#a02cd8809c77bc3d39ef83db867463c82">SSL3_RECORD_get_length</a>(rr);</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            n = <a class="code" href="ct_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        memcpy(buf, &amp;(<a class="code" href="record__locl_8h.html#aa55011b6b9147d3d12a5c9512c9e23fd">SSL3_RECORD_get_data</a>(rr)[<a class="code" href="record__locl_8h.html#ae02c202b74534697d0095217528f60c7">SSL3_RECORD_get_off</a>(rr)]), n);</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keywordflow">if</span> (!peek) {</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            <a class="code" href="record__locl_8h.html#ab865bec33496b20b20576edc81dd1c65">SSL3_RECORD_sub_length</a>(rr, n);</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            <a class="code" href="record__locl_8h.html#ae69454bd8c71d7de11ca2c0d85388749">SSL3_RECORD_add_off</a>(rr, n);</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="record__locl_8h.html#a02cd8809c77bc3d39ef83db867463c82">SSL3_RECORD_get_length</a>(rr) == 0) {</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                s-&gt;rlayer.rstate = <a class="code" href="ssl_8h.html#a4ac2fe10be63807edcd8ce6b4cbf846e">SSL_ST_READ_HEADER</a>;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                <a class="code" href="record__locl_8h.html#a5bd4a7019a6a2cb8cdef9dcddd5f7c73">SSL3_RECORD_set_off</a>(rr, 0);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            }</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        }</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="preprocessor">#ifndef OPENSSL_NO_SCTP</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment">         * We were about to renegotiate but had to read belated application</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">         * data first, so retry.</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="bss__dgram_8c.html#a1f335fa8b46ddcdfc52cf260781363f9">BIO_dgram_is_sctp</a>(<a class="code" href="ssl_8h.html#ade818ef4efdc44c84043909e4b466d3b">SSL_get_rbio</a>(s)) &amp;&amp;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            <a class="code" href="record__locl_8h.html#a3ad663c2b589f8e007f99e3e402c330e">SSL3_RECORD_get_type</a>(rr) == <a class="code" href="ssl3_8h.html#a96e6f315f7fe97caf2634fb434700e25">SSL3_RT_APPLICATION_DATA</a> &amp;&amp;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            <a class="code" href="statem_8c.html#adb23f211302fad874f72e889ee0cf2b3">ossl_statem_in_sctp_read_sock</a>(s)) {</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            s-&gt;rwstate = <a class="code" href="ssl_8h.html#a5937e98ddad766e0b7dd6c6b6cb6953f">SSL_READING</a>;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            <a class="code" href="openssl_2bio_8h.html#a116e3d4381163644299656218d9c6112">BIO_clear_retry_flags</a>(<a class="code" href="ssl_8h.html#ade818ef4efdc44c84043909e4b466d3b">SSL_get_rbio</a>(s));</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            <a class="code" href="openssl_2bio_8h.html#af5f66c03eb3665ce8f37c3d08e4e7818">BIO_set_retry_read</a>(<a class="code" href="ssl_8h.html#ade818ef4efdc44c84043909e4b466d3b">SSL_get_rbio</a>(s));</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        }</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">         * We might had to delay a close_notify alert because of reordered</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment">         * app data. If there was an alert and there is no message to read</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">         * anymore, finally set shutdown.</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="bss__dgram_8c.html#a1f335fa8b46ddcdfc52cf260781363f9">BIO_dgram_is_sctp</a>(<a class="code" href="ssl_8h.html#ade818ef4efdc44c84043909e4b466d3b">SSL_get_rbio</a>(s)) &amp;&amp;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            s-&gt;d1-&gt;shutdown_received</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            &amp;&amp; !<a class="code" href="bss__dgram_8c.html#a09e63d1cdf0269f007905bb57911797e">BIO_dgram_sctp_msg_waiting</a>(<a class="code" href="ssl_8h.html#ade818ef4efdc44c84043909e4b466d3b">SSL_get_rbio</a>(s))) {</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            s-&gt;shutdown |= <a class="code" href="ssl_8h.html#acc867649d6aac0f6cbea1ea8ff213a50">SSL_RECEIVED_SHUTDOWN</a>;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        }</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        *readbytes = n;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    }</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment">     * If we get here, then type != rr-&gt;type; if we have a handshake message,</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment">     * then it was unexpected (Hello Request or Client Hello).</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">     * In case of record types for which we have &#39;fragment&#39; storage, fill</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment">     * that so that we can process the data at a fixed place.</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    {</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <span class="keywordtype">size_t</span> k, dest_maxlen = 0;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *dest = <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <span class="keywordtype">size_t</span> *dest_len = <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="record__locl_8h.html#a3ad663c2b589f8e007f99e3e402c330e">SSL3_RECORD_get_type</a>(rr) == <a class="code" href="ssl3_8h.html#a913c4ab23166cbc9b67d6f759f7c87e5">SSL3_RT_HANDSHAKE</a>) {</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;            dest_maxlen = <span class="keyword">sizeof</span> s-&gt;rlayer.d-&gt;handshake_fragment;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;            dest = s-&gt;rlayer.d-&gt;handshake_fragment;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            dest_len = &amp;s-&gt;rlayer.d-&gt;handshake_fragment_len;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="record__locl_8h.html#a3ad663c2b589f8e007f99e3e402c330e">SSL3_RECORD_get_type</a>(rr) == <a class="code" href="ssl3_8h.html#ac2ed784b96ecdc1d92d805793dd8a14c">SSL3_RT_ALERT</a>) {</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            dest_maxlen = <span class="keyword">sizeof</span>(s-&gt;rlayer.d-&gt;alert_fragment);</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            dest = s-&gt;rlayer.d-&gt;alert_fragment;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            dest_len = &amp;s-&gt;rlayer.d-&gt;alert_fragment_len;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        }</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="comment">/* else it&#39;s a CCS message, or application data or wrong */</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="record__locl_8h.html#a3ad663c2b589f8e007f99e3e402c330e">SSL3_RECORD_get_type</a>(rr) != <a class="code" href="ssl3_8h.html#ae54807cec33243767b2d18ec1e4dc290">SSL3_RT_CHANGE_CIPHER_SPEC</a>) {</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">             * Application data while renegotiating is allowed. Try again</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">             * reading.</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="record__locl_8h.html#a3ad663c2b589f8e007f99e3e402c330e">SSL3_RECORD_get_type</a>(rr) == <a class="code" href="ssl3_8h.html#a96e6f315f7fe97caf2634fb434700e25">SSL3_RT_APPLICATION_DATA</a>) {</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                BIO *bio;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                s-&gt;s3-&gt;in_read_app_data = 2;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                bio = <a class="code" href="ssl_8h.html#ade818ef4efdc44c84043909e4b466d3b">SSL_get_rbio</a>(s);</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                s-&gt;rwstate = <a class="code" href="ssl_8h.html#a5937e98ddad766e0b7dd6c6b6cb6953f">SSL_READING</a>;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                <a class="code" href="openssl_2bio_8h.html#a116e3d4381163644299656218d9c6112">BIO_clear_retry_flags</a>(bio);</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                <a class="code" href="openssl_2bio_8h.html#af5f66c03eb3665ce8f37c3d08e4e7818">BIO_set_retry_read</a>(bio);</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            }</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            <span class="comment">/* Not certain if this is the right error handling */</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            al = <a class="code" href="ssl_8h.html#adda5f067eef1a4868484abb8fe45287e">SSL_AD_UNEXPECTED_MESSAGE</a>;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            <a class="code" href="openssl_2err_8h.html#a85650ea112d3012313596df1cb1b7760">SSLerr</a>(<a class="code" href="ssl_8h.html#ad5ba194c84ab706f94cde94d02296ff3">SSL_F_DTLS1_READ_BYTES</a>, <a class="code" href="ssl_8h.html#a9242201b2900a585b4c459cdb188c8e0">SSL_R_UNEXPECTED_RECORD</a>);</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            <span class="keywordflow">goto</span> f_err;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        }</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <span class="keywordflow">if</span> (dest_maxlen &gt; 0) {</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment">             * XDTLS: In a pathological case, the Client Hello may be</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="comment">             * fragmented--don&#39;t always expect dest_maxlen bytes</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="record__locl_8h.html#a02cd8809c77bc3d39ef83db867463c82">SSL3_RECORD_get_length</a>(rr) &lt; dest_maxlen) {</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="preprocessor">#ifdef DTLS1_AD_MISSING_HANDSHAKE_MESSAGE</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                <span class="comment">/*</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">                 * for normal alerts rr-&gt;length is 2, while</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">                 * dest_maxlen is 7 if we were to handle this</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">                 * non-existing alert...</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment">                 */</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                FIX ME;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                s-&gt;rlayer.rstate = <a class="code" href="ssl_8h.html#a4ac2fe10be63807edcd8ce6b4cbf846e">SSL_ST_READ_HEADER</a>;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                <a class="code" href="record__locl_8h.html#ab8fa0ea13a2529e8def561656f2f9d8e">SSL3_RECORD_set_length</a>(rr, 0);</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            }</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;            <span class="comment">/* now move &#39;n&#39; bytes: */</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            <span class="keywordflow">for</span> (k = 0; k &lt; dest_maxlen; k++) {</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                dest[k] = <a class="code" href="record__locl_8h.html#aa55011b6b9147d3d12a5c9512c9e23fd">SSL3_RECORD_get_data</a>(rr)[<a class="code" href="record__locl_8h.html#ae02c202b74534697d0095217528f60c7">SSL3_RECORD_get_off</a>(rr)];</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                <a class="code" href="record__locl_8h.html#ae69454bd8c71d7de11ca2c0d85388749">SSL3_RECORD_add_off</a>(rr, 1);</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                <a class="code" href="record__locl_8h.html#ab27d3a5679c9417d842f23d5b6fb973a">SSL3_RECORD_add_length</a>(rr, -1);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            }</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            *dest_len = dest_maxlen;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        }</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    }</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="comment">/*-</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment">     * s-&gt;rlayer.d-&gt;handshake_fragment_len == 12  iff  rr-&gt;type == SSL3_RT_HANDSHAKE;</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="comment">     * s-&gt;rlayer.d-&gt;alert_fragment_len == 7      iff  rr-&gt;type == SSL3_RT_ALERT.</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment">     * (Possibly rr is &#39;empty&#39; now, i.e. rr-&gt;length may be 0.)</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="keywordflow">if</span> (s-&gt;rlayer.d-&gt;alert_fragment_len &gt;= <a class="code" href="dtls1_8h.html#a0b67a04e169539f32cbc3c4951f4340a">DTLS1_AL_HEADER_LENGTH</a>) {</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <span class="keywordtype">int</span> alert_level = s-&gt;rlayer.d-&gt;alert_fragment[0];</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        <span class="keywordtype">int</span> alert_descr = s-&gt;rlayer.d-&gt;alert_fragment[1];</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        s-&gt;rlayer.d-&gt;alert_fragment_len = 0;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        <span class="keywordflow">if</span> (s-&gt;msg_callback)</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;            s-&gt;msg_callback(0, s-&gt;version, <a class="code" href="ssl3_8h.html#ac2ed784b96ecdc1d92d805793dd8a14c">SSL3_RT_ALERT</a>,</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                            s-&gt;rlayer.d-&gt;alert_fragment, 2, s,</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                            s-&gt;msg_callback_arg);</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        <span class="keywordflow">if</span> (s-&gt;info_callback != <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>)</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            <a class="code" href="bn_8h.html#a3440f8540faaec9c34da16295933680d">cb</a> = s-&gt;info_callback;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s-&gt;ctx-&gt;info_callback != <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>)</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            <a class="code" href="bn_8h.html#a3440f8540faaec9c34da16295933680d">cb</a> = s-&gt;ctx-&gt;info_callback;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#a3440f8540faaec9c34da16295933680d">cb</a> != <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>) {</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            j = (alert_level &lt;&lt; 8) | alert_descr;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;            <a class="code" href="bn_8h.html#a3440f8540faaec9c34da16295933680d">cb</a>(s, <a class="code" href="ssl_8h.html#ad40cd015db83f7556027b0105995716f">SSL_CB_READ_ALERT</a>, j);</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        }</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <span class="keywordflow">if</span> (alert_level == <a class="code" href="ssl3_8h.html#a8df25aafb22ec245bc2c74099fb70091">SSL3_AL_WARNING</a>) {</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;            s-&gt;s3-&gt;warn_alert = alert_descr;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;            s-&gt;rlayer.alert_count++;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;            <span class="keywordflow">if</span> (s-&gt;rlayer.alert_count == <a class="code" href="record__locl_8h.html#ab3d721980ec3ac03e60d8c23513eb56b">MAX_WARN_ALERT_COUNT</a>) {</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                al = <a class="code" href="ssl_8h.html#adda5f067eef1a4868484abb8fe45287e">SSL_AD_UNEXPECTED_MESSAGE</a>;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                <a class="code" href="openssl_2err_8h.html#a85650ea112d3012313596df1cb1b7760">SSLerr</a>(<a class="code" href="ssl_8h.html#ad5ba194c84ab706f94cde94d02296ff3">SSL_F_DTLS1_READ_BYTES</a>, <a class="code" href="ssl_8h.html#a73d206f471bf26c595be8d2ecae9722c">SSL_R_TOO_MANY_WARN_ALERTS</a>);</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                <span class="keywordflow">goto</span> f_err;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;            }</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;            <span class="keywordflow">if</span> (alert_descr == <a class="code" href="ssl_8h.html#a1a7aef992a2aa0c2f74935f20149c7e3">SSL_AD_CLOSE_NOTIFY</a>) {</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="preprocessor">#ifndef OPENSSL_NO_SCTP</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                <span class="comment">/*</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="comment">                 * With SCTP and streams the socket may deliver app data</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment">                 * after a close_notify alert. We have to check this first so</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment">                 * that nothing gets discarded.</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="comment">                 */</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="bss__dgram_8c.html#a1f335fa8b46ddcdfc52cf260781363f9">BIO_dgram_is_sctp</a>(<a class="code" href="ssl_8h.html#ade818ef4efdc44c84043909e4b466d3b">SSL_get_rbio</a>(s)) &amp;&amp;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                    <a class="code" href="bss__dgram_8c.html#a09e63d1cdf0269f007905bb57911797e">BIO_dgram_sctp_msg_waiting</a>(<a class="code" href="ssl_8h.html#ade818ef4efdc44c84043909e4b466d3b">SSL_get_rbio</a>(s))) {</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                    s-&gt;d1-&gt;shutdown_received = 1;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                    s-&gt;rwstate = <a class="code" href="ssl_8h.html#a5937e98ddad766e0b7dd6c6b6cb6953f">SSL_READING</a>;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                    <a class="code" href="openssl_2bio_8h.html#a116e3d4381163644299656218d9c6112">BIO_clear_retry_flags</a>(<a class="code" href="ssl_8h.html#ade818ef4efdc44c84043909e4b466d3b">SSL_get_rbio</a>(s));</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                    <a class="code" href="openssl_2bio_8h.html#af5f66c03eb3665ce8f37c3d08e4e7818">BIO_set_retry_read</a>(<a class="code" href="ssl_8h.html#ade818ef4efdc44c84043909e4b466d3b">SSL_get_rbio</a>(s));</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                }</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                s-&gt;shutdown |= <a class="code" href="ssl_8h.html#acc867649d6aac0f6cbea1ea8ff213a50">SSL_RECEIVED_SHUTDOWN</a>;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;            }</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="preprocessor">#if 0</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;            <span class="comment">/* XXX: this is a possible improvement in the future */</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;            <span class="comment">/* now check if it&#39;s a missing record */</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;            <span class="keywordflow">if</span> (alert_descr == DTLS1_AD_MISSING_HANDSHAKE_MESSAGE) {</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="bad__dtls__test_8c.html#a189930c4babdc38135a74db479534069">seq</a>;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> frag_off;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p = &amp;(s-&gt;rlayer.d-&gt;alert_fragment[2]);</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                <a class="code" href="ct__locl_8h.html#afd464cc3fd54170b0469540b665914fd">n2s</a>(p, seq);</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                <a class="code" href="ssl__locl_8h.html#ad0a3f3b8c4b9f8c9dfd63c0cf0e7b34a">n2l3</a>(p, frag_off);</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                <a class="code" href="ssl__locl_8h.html#ad01b818045bf1cef5f0af7fc25aa3b59">dtls1_retransmit_message</a>(s,</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                                         <a class="code" href="ssl__locl_8h.html#ac4a8703cf10b6dedb432310701ecc58e">dtls1_get_queue_priority</a></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                                         (frag-&gt;msg_header.seq, 0), frag_off,</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                                         &amp;found);</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                <span class="keywordflow">if</span> (!found &amp;&amp; <a class="code" href="ssl_8h.html#a8bcb06e82fc1107090412d76163045f5">SSL_in_init</a>(s)) {</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                    <span class="comment">/*</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="comment">                     * fprintf( stderr,&quot;in init = %d\n&quot;, SSL_in_init(s));</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="comment">                     */</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                    <span class="comment">/*</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">                     * requested a message not yet sent, send an alert</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="comment">                     * ourselves</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment">                     */</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                    <a class="code" href="s3__msg_8c.html#a9e42a91e282847c50bd4cf748c5d4618">ssl3_send_alert</a>(s, <a class="code" href="ssl3_8h.html#a8df25aafb22ec245bc2c74099fb70091">SSL3_AL_WARNING</a>,</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                                    DTLS1_AD_MISSING_HANDSHAKE_MESSAGE);</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                }</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            }</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (alert_level == <a class="code" href="ssl3_8h.html#a198c2af04c8f09f7012a8a9c0cfe2f46">SSL3_AL_FATAL</a>) {</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;            <span class="keywordtype">char</span> tmp[16];</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;            s-&gt;rwstate = <a class="code" href="ssl_8h.html#a620f769f6a2c309539b068dd2c079442">SSL_NOTHING</a>;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;            s-&gt;s3-&gt;fatal_alert = alert_descr;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            <a class="code" href="openssl_2err_8h.html#a85650ea112d3012313596df1cb1b7760">SSLerr</a>(<a class="code" href="ssl_8h.html#ad5ba194c84ab706f94cde94d02296ff3">SSL_F_DTLS1_READ_BYTES</a>, <a class="code" href="ssl_8h.html#ae636aa8c372a9b15174d8f25fa3093e3">SSL_AD_REASON_OFFSET</a> + alert_descr);</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            <a class="code" href="b__print_8c.html#a81ca789053c48a3b5201d3dc2431b0dd">BIO_snprintf</a>(tmp, <span class="keyword">sizeof</span> tmp, <span class="stringliteral">&quot;%d&quot;</span>, alert_descr);</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;            <a class="code" href="err_8c.html#a89d6b806fcd20c4ea07229451d489616">ERR_add_error_data</a>(2, <span class="stringliteral">&quot;SSL alert number &quot;</span>, tmp);</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            s-&gt;shutdown |= <a class="code" href="ssl_8h.html#acc867649d6aac0f6cbea1ea8ff213a50">SSL_RECEIVED_SHUTDOWN</a>;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            <a class="code" href="ssl_8h.html#a0b1799f93fc382f92cb1ba58a25b1c90">SSL_CTX_remove_session</a>(s-&gt;session_ctx, s-&gt;session);</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;            al = <a class="code" href="ssl_8h.html#a70b42e45c1dadd37c0e74b9b21393e26">SSL_AD_ILLEGAL_PARAMETER</a>;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;            <a class="code" href="openssl_2err_8h.html#a85650ea112d3012313596df1cb1b7760">SSLerr</a>(<a class="code" href="ssl_8h.html#ad5ba194c84ab706f94cde94d02296ff3">SSL_F_DTLS1_READ_BYTES</a>, <a class="code" href="ssl_8h.html#a6984ab7dad158669c9617302e31bb669">SSL_R_UNKNOWN_ALERT_TYPE</a>);</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;            <span class="keywordflow">goto</span> f_err;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        }</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    }</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordflow">if</span> (s-&gt;shutdown &amp; <a class="code" href="ssl_8h.html#aa02414f420816d9aec68e677ed26aeb4">SSL_SENT_SHUTDOWN</a>) { <span class="comment">/* but we have not received a</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment">                                            * shutdown */</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        s-&gt;rwstate = <a class="code" href="ssl_8h.html#a620f769f6a2c309539b068dd2c079442">SSL_NOTHING</a>;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        <a class="code" href="record__locl_8h.html#ab8fa0ea13a2529e8def561656f2f9d8e">SSL3_RECORD_set_length</a>(rr, 0);</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    }</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="record__locl_8h.html#a3ad663c2b589f8e007f99e3e402c330e">SSL3_RECORD_get_type</a>(rr) == <a class="code" href="ssl3_8h.html#ae54807cec33243767b2d18ec1e4dc290">SSL3_RT_CHANGE_CIPHER_SPEC</a>) {</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="comment">         * We can&#39;t process a CCS now, because previous handshake messages</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment">         * are still missing, so just drop it.</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        <a class="code" href="record__locl_8h.html#ab8fa0ea13a2529e8def561656f2f9d8e">SSL3_RECORD_set_length</a>(rr, 0);</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    }</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="comment">     * Unexpected handshake message (Client Hello, or protocol violation)</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="keywordflow">if</span> ((s-&gt;rlayer.d-&gt;handshake_fragment_len &gt;= <a class="code" href="dtls1_8h.html#a313ba59cb24cf778204cfff800bebc4c">DTLS1_HM_HEADER_LENGTH</a>) &amp;&amp;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        !<a class="code" href="statem_8c.html#a21ec74f54ef5c0f0543304b2ec35f762">ossl_statem_get_in_handshake</a>(s)) {</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        <span class="keyword">struct </span><a class="code" href="structhm__header__st.html">hm_header_st</a> msg_hdr;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        <span class="comment">/* this may just be a stale retransmit */</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <a class="code" href="ssl__locl_8h.html#af327758122fe033174d1d377bef3faa8">dtls1_get_message_header</a>(rr-&gt;<a class="code" href="structSSL3__RECORD.html#ac24cea2bfcc927fd29bc74d1086707d8">data</a>, &amp;msg_hdr);</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="record__locl_8h.html#af1d036179208c95e57e4399754f63708">SSL3_RECORD_get_epoch</a>(rr) != s-&gt;rlayer.d-&gt;r_epoch) {</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            <a class="code" href="record__locl_8h.html#ab8fa0ea13a2529e8def561656f2f9d8e">SSL3_RECORD_set_length</a>(rr, 0);</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        }</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="comment">         * If we are server, we may have a repeated FINISHED of the client</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="comment">         * here, then retransmit our CCS and FINISHED.</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        <span class="keywordflow">if</span> (msg_hdr.<a class="code" href="structhm__header__st.html#aa5044999f3339d2ba3b1bf22fa6cfe95">type</a> == <a class="code" href="ssl3_8h.html#ad961b12ab367d2832c377e1425d06684">SSL3_MT_FINISHED</a>) {</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="d1__lib_8c.html#a3e5f57fb7fad8cbb2b3376a42b2bd555">dtls1_check_timeout_num</a>(s) &lt; 0)</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            <a class="code" href="ssl__locl_8h.html#ab1b76f2c15a4cbb1072f22e247405417">dtls1_retransmit_buffered_messages</a>(s);</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            <a class="code" href="record__locl_8h.html#ab8fa0ea13a2529e8def561656f2f9d8e">SSL3_RECORD_set_length</a>(rr, 0);</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        }</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="comment">         * To get here we must be trying to read app data but found handshake</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="comment">         * data. But if we&#39;re trying to read app data, and we&#39;re not in init</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="comment">         * (which is tested for at the top of this function) then init must be</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="comment">         * finished</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        assert(<a class="code" href="ssl_8h.html#afd5c90111dbeeb7667a62bbdf8337d98">SSL_is_init_finished</a>(s));</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="ssl_8h.html#afd5c90111dbeeb7667a62bbdf8337d98">SSL_is_init_finished</a>(s)) {</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;            al = <a class="code" href="ssl_8h.html#ad518421573c23757abb58d60cf291804">SSL_AD_INTERNAL_ERROR</a>;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            <a class="code" href="openssl_2err_8h.html#a85650ea112d3012313596df1cb1b7760">SSLerr</a>(<a class="code" href="ssl_8h.html#ad5ba194c84ab706f94cde94d02296ff3">SSL_F_DTLS1_READ_BYTES</a>, <a class="code" href="openssl_2err_8h.html#ac863d0e29abbb6c480be6983fd48bf42">ERR_R_INTERNAL_ERROR</a>);</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;            <span class="keywordflow">goto</span> f_err;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        }</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        <span class="comment">/* We found handshake data, so we&#39;re going back into init */</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <a class="code" href="statem_8c.html#ae91ddf9b8a470a0f2e356cacb7995121">ossl_statem_set_in_init</a>(s, 1);</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        i = s-&gt;handshake_func(s);</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <span class="keywordflow">if</span> (i &lt; 0)</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;            <span class="keywordflow">return</span> i;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        <span class="keywordflow">if</span> (i == 0) {</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;            <a class="code" href="openssl_2err_8h.html#a85650ea112d3012313596df1cb1b7760">SSLerr</a>(<a class="code" href="ssl_8h.html#ad5ba194c84ab706f94cde94d02296ff3">SSL_F_DTLS1_READ_BYTES</a>, <a class="code" href="ssl_8h.html#a0670a14fbc4206622336d9cea3bb03f7">SSL_R_SSL_HANDSHAKE_FAILURE</a>);</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        }</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="keywordflow">if</span> (!(s-&gt;mode &amp; <a class="code" href="ssl_8h.html#a384de8eaf47464df5c2b7ff1c281995d">SSL_MODE_AUTO_RETRY</a>)) {</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="record__locl_8h.html#a8a8fa930ff9d5578c68f31001fcdd765">SSL3_BUFFER_get_left</a>(&amp;s-&gt;rlayer.rbuf) == 0) {</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                <span class="comment">/* no read-ahead left? */</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                BIO *bio;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                <span class="comment">/*</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;<span class="comment">                 * In the case where we try to read application data, but we</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="comment">                 * trigger an SSL handshake, we return -1 with the retry</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="comment">                 * option set.  Otherwise renegotiation may cause nasty</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="comment">                 * problems in the blocking world</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="comment">                 */</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                s-&gt;rwstate = <a class="code" href="ssl_8h.html#a5937e98ddad766e0b7dd6c6b6cb6953f">SSL_READING</a>;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                bio = <a class="code" href="ssl_8h.html#ade818ef4efdc44c84043909e4b466d3b">SSL_get_rbio</a>(s);</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                <a class="code" href="openssl_2bio_8h.html#a116e3d4381163644299656218d9c6112">BIO_clear_retry_flags</a>(bio);</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                <a class="code" href="openssl_2bio_8h.html#af5f66c03eb3665ce8f37c3d08e4e7818">BIO_set_retry_read</a>(bio);</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            }</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        }</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    }</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="record__locl_8h.html#a3ad663c2b589f8e007f99e3e402c330e">SSL3_RECORD_get_type</a>(rr)) {</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        <span class="comment">/* TLS just ignores unknown message types */</span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        <span class="keywordflow">if</span> (s-&gt;version == <a class="code" href="tls1_8h.html#af767b3a75f9ad21c9b6ab961add3bfec">TLS1_VERSION</a>) {</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;            <a class="code" href="record__locl_8h.html#ab8fa0ea13a2529e8def561656f2f9d8e">SSL3_RECORD_set_length</a>(rr, 0);</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;            <span class="keywordflow">goto</span> start;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        }</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        al = <a class="code" href="ssl_8h.html#adda5f067eef1a4868484abb8fe45287e">SSL_AD_UNEXPECTED_MESSAGE</a>;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        <a class="code" href="openssl_2err_8h.html#a85650ea112d3012313596df1cb1b7760">SSLerr</a>(<a class="code" href="ssl_8h.html#ad5ba194c84ab706f94cde94d02296ff3">SSL_F_DTLS1_READ_BYTES</a>, <a class="code" href="ssl_8h.html#a9242201b2900a585b4c459cdb188c8e0">SSL_R_UNEXPECTED_RECORD</a>);</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        <span class="keywordflow">goto</span> f_err;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ssl3_8h.html#ae54807cec33243767b2d18ec1e4dc290">SSL3_RT_CHANGE_CIPHER_SPEC</a>:</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ssl3_8h.html#ac2ed784b96ecdc1d92d805793dd8a14c">SSL3_RT_ALERT</a>:</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ssl3_8h.html#a913c4ab23166cbc9b67d6f759f7c87e5">SSL3_RT_HANDSHAKE</a>:</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="comment">         * we already handled all of these, with the possible exception of</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="comment">         * SSL3_RT_HANDSHAKE when ossl_statem_get_in_handshake(s) is true, but</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment">         * that should not happen when type != rr-&gt;type</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        al = <a class="code" href="ssl_8h.html#adda5f067eef1a4868484abb8fe45287e">SSL_AD_UNEXPECTED_MESSAGE</a>;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        <a class="code" href="openssl_2err_8h.html#a85650ea112d3012313596df1cb1b7760">SSLerr</a>(<a class="code" href="ssl_8h.html#ad5ba194c84ab706f94cde94d02296ff3">SSL_F_DTLS1_READ_BYTES</a>, <a class="code" href="openssl_2err_8h.html#ac863d0e29abbb6c480be6983fd48bf42">ERR_R_INTERNAL_ERROR</a>);</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        <span class="keywordflow">goto</span> f_err;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ssl3_8h.html#a96e6f315f7fe97caf2634fb434700e25">SSL3_RT_APPLICATION_DATA</a>:</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="comment">         * At this point, we were expecting handshake data, but have</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="comment">         * application data.  If the library was running inside ssl3_read()</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="comment">         * (i.e. in_read_app_data is set) and it makes sense to read</span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="comment">         * application data at this point (session renegotiation not yet</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="comment">         * started), we will indulge it.</span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <span class="keywordflow">if</span> (s-&gt;s3-&gt;in_read_app_data &amp;&amp;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;            (s-&gt;s3-&gt;total_renegotiations != 0) &amp;&amp;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;            <a class="code" href="statem_8c.html#a19ba352eaf7e02ce800b6a8332ff8170">ossl_statem_app_data_allowed</a>(s)) {</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;            s-&gt;s3-&gt;in_read_app_data = 2;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;            al = <a class="code" href="ssl_8h.html#adda5f067eef1a4868484abb8fe45287e">SSL_AD_UNEXPECTED_MESSAGE</a>;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            <a class="code" href="openssl_2err_8h.html#a85650ea112d3012313596df1cb1b7760">SSLerr</a>(<a class="code" href="ssl_8h.html#ad5ba194c84ab706f94cde94d02296ff3">SSL_F_DTLS1_READ_BYTES</a>, <a class="code" href="ssl_8h.html#a9242201b2900a585b4c459cdb188c8e0">SSL_R_UNEXPECTED_RECORD</a>);</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            <span class="keywordflow">goto</span> f_err;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        }</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    }</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="comment">/* not reached */</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160; f_err:</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <a class="code" href="s3__msg_8c.html#a9e42a91e282847c50bd4cf748c5d4618">ssl3_send_alert</a>(s, <a class="code" href="ssl3_8h.html#a198c2af04c8f09f7012a8a9c0cfe2f46">SSL3_AL_FATAL</a>, al);</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;}</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="comment"> * this only happens when a client hello is received and a handshake</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="comment"> * is started.</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="keyword">static</span> <span class="keywordtype">size_t</span> have_handshake_fragment(SSL *s, <span class="keywordtype">int</span> <a class="code" href="e__aes_8c.html#ab512b8f495325c7ea0f5a5a5d3f938eb">type</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf,</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                                      <span class="keywordtype">size_t</span> <a class="code" href="ct_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>)</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;{</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="e__aes_8c.html#ab512b8f495325c7ea0f5a5a5d3f938eb">type</a> == <a class="code" href="ssl3_8h.html#a913c4ab23166cbc9b67d6f759f7c87e5">SSL3_RT_HANDSHAKE</a>)</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        &amp;&amp; (s-&gt;rlayer.d-&gt;handshake_fragment_len &gt; 0))</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        <span class="comment">/* (partially) satisfy request from storage */</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    {</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *src = s-&gt;rlayer.d-&gt;handshake_fragment;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *dst = buf;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        <span class="keywordtype">size_t</span> k, n;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        <span class="comment">/* peek == 0 */</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        n = 0;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        <span class="keywordflow">while</span> ((len &gt; 0) &amp;&amp; (s-&gt;rlayer.d-&gt;handshake_fragment_len &gt; 0)) {</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;            *dst++ = *src++;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;            len--;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;            s-&gt;rlayer.d-&gt;handshake_fragment_len--;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;            n++;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        }</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <span class="comment">/* move any remaining fragment bytes: */</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        <span class="keywordflow">for</span> (k = 0; k &lt; s-&gt;rlayer.d-&gt;handshake_fragment_len; k++)</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;            s-&gt;rlayer.d-&gt;handshake_fragment[k] = *src++;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        <span class="keywordflow">return</span> n;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    }</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;}</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="comment"> * Call this to write data in records of type &#39;type&#39; It will return &lt;= 0 if</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="comment"> * not all data has been sent or non-blocking IO.</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00905"></a><span class="lineno"><a class="line" href="record_8h.html#ae0ec70023686f97112267613b86a9c63">  905</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="rec__layer__d1_8c.html#aa2e1499ab8df139c1bd6a4abc6cf5550">dtls1_write_bytes</a>(SSL *s, <span class="keywordtype">int</span> <a class="code" href="e__aes_8c.html#ab512b8f495325c7ea0f5a5a5d3f938eb">type</a>, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf, <span class="keywordtype">size_t</span> <a class="code" href="ct_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>,</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                      <span class="keywordtype">size_t</span> *written)</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;{</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <a class="code" href="crypto_8h.html#a6e3638bf542fc7a6a394f34124aa2cba">OPENSSL_assert</a>(len &lt;= <a class="code" href="ssl3_8h.html#aa5675bd7936c6fef8f9b5b2cea8f0baf">SSL3_RT_MAX_PLAIN_LENGTH</a>);</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    s-&gt;rwstate = <a class="code" href="ssl_8h.html#a620f769f6a2c309539b068dd2c079442">SSL_NOTHING</a>;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    i = <a class="code" href="rec__layer__d1_8c.html#afafdddaa7c8acabaed11ef8e81620aab">do_dtls1_write</a>(s, type, buf, len, 0, written);</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    <span class="keywordflow">return</span> i;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;}</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;</div><div class="line"><a name="l00916"></a><span class="lineno"><a class="line" href="record_8h.html#afafdddaa7c8acabaed11ef8e81620aab">  916</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="rec__layer__d1_8c.html#afafdddaa7c8acabaed11ef8e81620aab">do_dtls1_write</a>(SSL *s, <span class="keywordtype">int</span> <a class="code" href="e__aes_8c.html#ab512b8f495325c7ea0f5a5a5d3f938eb">type</a>, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf,</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                   <span class="keywordtype">size_t</span> <a class="code" href="ct_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>, <span class="keywordtype">int</span> create_empty_fragment, <span class="keywordtype">size_t</span> *written)</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;{</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p, *pseq;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    <span class="keywordtype">int</span> i, mac_size, clear = 0;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <span class="keywordtype">size_t</span> prefix_len = 0;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <span class="keywordtype">int</span> eivlen;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <a class="code" href="structSSL3__RECORD.html">SSL3_RECORD</a> wr;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <a class="code" href="structSSL3__BUFFER.html">SSL3_BUFFER</a> *wb;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    SSL_SESSION *sess;</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    wb = &amp;s-&gt;rlayer.wbuf[0];</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="comment">     * first check if there is a SSL3_BUFFER still being written out.  This</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment">     * will happen with non blocking IO</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="record__locl_8h.html#a8a8fa930ff9d5578c68f31001fcdd765">SSL3_BUFFER_get_left</a>(wb) != 0) {</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        <a class="code" href="crypto_8h.html#a6e3638bf542fc7a6a394f34124aa2cba">OPENSSL_assert</a>(0);      <span class="comment">/* XDTLS: want to see if we ever get here */</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="rec__layer__s3_8c.html#a740a746da04337932287b5c891f5408a">ssl3_write_pending</a>(s, type, buf, len, written);</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    }</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    <span class="comment">/* If we have an alert to send, lets send it */</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    <span class="keywordflow">if</span> (s-&gt;s3-&gt;alert_dispatch) {</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        i = s-&gt;method-&gt;ssl_dispatch_alert(s);</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        <span class="keywordflow">if</span> (i &lt;= 0)</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;            <span class="keywordflow">return</span> i;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        <span class="comment">/* if it went, fall through and send more stuff */</span></div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    }</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keywordflow">if</span> (len == 0 &amp;&amp; !create_empty_fragment)</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    sess = s-&gt;session;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    <span class="keywordflow">if</span> ((sess == <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>) ||</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        (s-&gt;enc_write_ctx == <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>) || (<a class="code" href="evp__lib_8c.html#a71fed39076aec9a43d618177317e3691">EVP_MD_CTX_md</a>(s-&gt;write_hash) == <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>))</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        clear = 1;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="keywordflow">if</span> (clear)</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        mac_size = 0;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        mac_size = <a class="code" href="evp_8h.html#a44b4d4d994e27b818f85185a9d45fa81">EVP_MD_CTX_size</a>(s-&gt;write_hash);</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        <span class="keywordflow">if</span> (mac_size &lt; 0)</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;            <span class="keywordflow">goto</span> err;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    }</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    p = <a class="code" href="record__locl_8h.html#a4fff0f254398dd21266e901e33c322a8">SSL3_BUFFER_get_buf</a>(wb) + prefix_len;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <span class="comment">/* write the header */</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    *(p++) = type &amp; 0xff;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <a class="code" href="record__locl_8h.html#a3690c828023760bce180d8f047226022">SSL3_RECORD_set_type</a>(&amp;wr, type);</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="comment">     * Special case: for hello verify request, client version 1.0 and we</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="comment">     * haven&#39;t decided which version to use yet send back using version 1.0</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="comment">     * header: otherwise some clients will ignore it.</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="keywordflow">if</span> (s-&gt;method-&gt;version == <a class="code" href="dtls1_8h.html#a761d8f994778953299d0f50c0fd4da62">DTLS_ANY_VERSION</a> &amp;&amp;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        s-&gt;max_proto_version != <a class="code" href="dtls1_8h.html#a078aed34c9324a49ad7299654038b127">DTLS1_BAD_VER</a>) {</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        *(p++) = <a class="code" href="dtls1_8h.html#a49ab36464030dc24b1922d8cbc66266b">DTLS1_VERSION</a> &gt;&gt; 8;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;        *(p++) = <a class="code" href="dtls1_8h.html#a49ab36464030dc24b1922d8cbc66266b">DTLS1_VERSION</a> &amp; 0xff;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        *(p++) = s-&gt;version &gt;&gt; 8;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        *(p++) = s-&gt;version &amp; 0xff;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    }</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="comment">/* field where we are to write out packet epoch, seq num and len */</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    pseq = p;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    p += 10;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="comment">/* Explicit IV length, block ciphers appropriate version flag */</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="keywordflow">if</span> (s-&gt;enc_write_ctx) {</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        <span class="keywordtype">int</span> mode = <a class="code" href="evp_8h.html#a227ab179b4712a4f47e5a053e9b80585">EVP_CIPHER_CTX_mode</a>(s-&gt;enc_write_ctx);</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        <span class="keywordflow">if</span> (mode == <a class="code" href="evp_8h.html#a789e2ef5a5767d4f6fd8b926ebb674e2">EVP_CIPH_CBC_MODE</a>) {</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;            eivlen = <a class="code" href="evp__lib_8c.html#af3201d12bcf0e13a885ca4cf5ee379f3">EVP_CIPHER_CTX_iv_length</a>(s-&gt;enc_write_ctx);</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;            <span class="keywordflow">if</span> (eivlen &lt;= 1)</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                eivlen = 0;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        }</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        <span class="comment">/* Need explicit part of IV for GCM mode */</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == <a class="code" href="evp_8h.html#a88edfa13679e5e1360836f8833b3032b">EVP_CIPH_GCM_MODE</a>)</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;            eivlen = <a class="code" href="evp_8h.html#a963fe8dd8de3699cb3cc543440873823">EVP_GCM_TLS_EXPLICIT_IV_LEN</a>;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == <a class="code" href="evp_8h.html#ab85ceaeb1a86e13bf1c58f2f0a962a39">EVP_CIPH_CCM_MODE</a>)</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;            eivlen = <a class="code" href="evp_8h.html#a3b159d81dd9118d614885aad3630b4be">EVP_CCM_TLS_EXPLICIT_IV_LEN</a>;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;            eivlen = 0;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    } <span class="keywordflow">else</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        eivlen = 0;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <span class="comment">/* lets setup the record stuff. */</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <a class="code" href="record__locl_8h.html#aac0493b345e27573e2f8d97359668dac">SSL3_RECORD_set_data</a>(&amp;wr, p + eivlen); <span class="comment">/* make room for IV in case of CBC */</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <a class="code" href="record__locl_8h.html#ab8fa0ea13a2529e8def561656f2f9d8e">SSL3_RECORD_set_length</a>(&amp;wr, len);</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    <a class="code" href="record__locl_8h.html#a43aa25a3541ec764acc3e9cd322f9633">SSL3_RECORD_set_input</a>(&amp;wr, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)buf);</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment">     * we now &#39;read&#39; from wr.input, wr.length bytes into wr.data</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <span class="comment">/* first we compress */</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="keywordflow">if</span> (s-&gt;compress != <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>) {</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="record__locl_8h.html#aba566fdce9a72316d621a22cb20b7bab">ssl3_do_compress</a>(s, &amp;wr)) {</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;            <a class="code" href="openssl_2err_8h.html#a85650ea112d3012313596df1cb1b7760">SSLerr</a>(<a class="code" href="ssl_8h.html#a0ee9b6da591dcba0f6900e6013d2fb3e">SSL_F_DO_DTLS1_WRITE</a>, <a class="code" href="ssl_8h.html#a68f2891a7debdcb21e853bb61e041ce2">SSL_R_COMPRESSION_FAILURE</a>);</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;            <span class="keywordflow">goto</span> err;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        }</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        memcpy(<a class="code" href="record__locl_8h.html#aa55011b6b9147d3d12a5c9512c9e23fd">SSL3_RECORD_get_data</a>(&amp;wr), <a class="code" href="record__locl_8h.html#a6462bf53e9be4f2c7d9259c2a7ecb1d9">SSL3_RECORD_get_input</a>(&amp;wr),</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;               <a class="code" href="record__locl_8h.html#a02cd8809c77bc3d39ef83db867463c82">SSL3_RECORD_get_length</a>(&amp;wr));</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        <a class="code" href="record__locl_8h.html#abda6657f9e5f0b2f714a98e2a82f3926">SSL3_RECORD_reset_input</a>(&amp;wr);</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    }</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment">     * we should still have the output to wr.data and the input from</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="comment">     * wr.input.  Length should be wr.length. wr.data still points in the</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="comment">     * wb-&gt;buf</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="ssl__locl_8h.html#a52e9a6bd3aa3e6373d70a0dbcf069c77">SSL_WRITE_ETM</a>(s) &amp;&amp; mac_size != 0) {</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        <span class="keywordflow">if</span> (!s-&gt;method-&gt;ssl3_enc-&gt;mac(s, &amp;wr,</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;                                      &amp;(p[<a class="code" href="record__locl_8h.html#a02cd8809c77bc3d39ef83db867463c82">SSL3_RECORD_get_length</a>(&amp;wr) + eivlen]),</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                                      1))</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;            <span class="keywordflow">goto</span> err;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        <a class="code" href="record__locl_8h.html#ab27d3a5679c9417d842f23d5b6fb973a">SSL3_RECORD_add_length</a>(&amp;wr, mac_size);</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    }</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <span class="comment">/* this is true regardless of mac size */</span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    <a class="code" href="record__locl_8h.html#aac0493b345e27573e2f8d97359668dac">SSL3_RECORD_set_data</a>(&amp;wr, p);</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <a class="code" href="record__locl_8h.html#abda6657f9e5f0b2f714a98e2a82f3926">SSL3_RECORD_reset_input</a>(&amp;wr);</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    <span class="keywordflow">if</span> (eivlen)</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        <a class="code" href="record__locl_8h.html#ab27d3a5679c9417d842f23d5b6fb973a">SSL3_RECORD_add_length</a>(&amp;wr, eivlen);</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    <span class="keywordflow">if</span> (s-&gt;method-&gt;ssl3_enc-&gt;enc(s, &amp;wr, 1, 1) &lt; 1)</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        <span class="keywordflow">goto</span> err;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ssl__locl_8h.html#a52e9a6bd3aa3e6373d70a0dbcf069c77">SSL_WRITE_ETM</a>(s) &amp;&amp; mac_size != 0) {</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        <span class="keywordflow">if</span> (!s-&gt;method-&gt;ssl3_enc-&gt;mac(s, &amp;wr,</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                                      &amp;(p[<a class="code" href="record__locl_8h.html#a02cd8809c77bc3d39ef83db867463c82">SSL3_RECORD_get_length</a>(&amp;wr)]), 1))</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;            <span class="keywordflow">goto</span> err;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        <a class="code" href="record__locl_8h.html#ab27d3a5679c9417d842f23d5b6fb973a">SSL3_RECORD_add_length</a>(&amp;wr, mac_size);</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    }</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    <span class="comment">/* record length after mac and block padding */</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment">     * if (type == SSL3_RT_APPLICATION_DATA || (type == SSL3_RT_ALERT &amp;&amp; !</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="comment">     * SSL_in_init(s)))</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    <span class="comment">/* there&#39;s only one epoch between handshake and app data */</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <a class="code" href="ct__locl_8h.html#a11fe10daafbfb28a38ba46f7213a225f">s2n</a>(s-&gt;rlayer.d-&gt;w_epoch, pseq);</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="comment">/* XDTLS: ?? */</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="comment">     * else s2n(s-&gt;d1-&gt;handshake_epoch, pseq);</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    memcpy(pseq, &amp;(s-&gt;rlayer.write_sequence[2]), 6);</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    pseq += 6;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <a class="code" href="ct__locl_8h.html#a11fe10daafbfb28a38ba46f7213a225f">s2n</a>(<a class="code" href="record__locl_8h.html#a02cd8809c77bc3d39ef83db867463c82">SSL3_RECORD_get_length</a>(&amp;wr), pseq);</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="keywordflow">if</span> (s-&gt;msg_callback)</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        s-&gt;msg_callback(1, 0, <a class="code" href="ssl3_8h.html#a4ce048ea75d9ad44b578ec3fb731f674">SSL3_RT_HEADER</a>, pseq - <a class="code" href="dtls1_8h.html#a7065450667dc936dd5c2b02a51000a30">DTLS1_RT_HEADER_LENGTH</a>,</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;                        <a class="code" href="dtls1_8h.html#a7065450667dc936dd5c2b02a51000a30">DTLS1_RT_HEADER_LENGTH</a>, s, s-&gt;msg_callback_arg);</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment">     * we should now have wr.data pointing to the encrypted data, which is</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment">     * wr-&gt;length long</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <a class="code" href="record__locl_8h.html#a3690c828023760bce180d8f047226022">SSL3_RECORD_set_type</a>(&amp;wr, type); <span class="comment">/* not needed but helps for debugging */</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <a class="code" href="record__locl_8h.html#ab27d3a5679c9417d842f23d5b6fb973a">SSL3_RECORD_add_length</a>(&amp;wr, <a class="code" href="dtls1_8h.html#a7065450667dc936dd5c2b02a51000a30">DTLS1_RT_HEADER_LENGTH</a>);</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <a class="code" href="rec__layer__s3_8c.html#a6a254a140e0603e963817febf308f928">ssl3_record_sequence_update</a>(&amp;(s-&gt;rlayer.write_sequence[0]));</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="keywordflow">if</span> (create_empty_fragment) {</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="comment">         * we are in a recursive call; just return the length, don&#39;t write</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment">         * out anything here</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        *written = wr.<a class="code" href="structSSL3__RECORD.html#ae809d5359ac030c60a30a8f0b2294b82">length</a>;</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    }</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <span class="comment">/* now let&#39;s set up wb */</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    <a class="code" href="record__locl_8h.html#affb27a8abb328cbd177a9c50c4b47cfd">SSL3_BUFFER_set_left</a>(wb, prefix_len + <a class="code" href="record__locl_8h.html#a02cd8809c77bc3d39ef83db867463c82">SSL3_RECORD_get_length</a>(&amp;wr));</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <a class="code" href="record__locl_8h.html#a8c444f18ca239c7708db48bbd23a5050">SSL3_BUFFER_set_offset</a>(wb, 0);</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="comment">     * memorize arguments so that ssl3_write_pending can detect bad write</span></div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="comment">     * retries later</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    s-&gt;rlayer.wpend_tot = <a class="code" href="ct_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    s-&gt;rlayer.wpend_buf = buf;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    s-&gt;rlayer.wpend_type = <a class="code" href="e__aes_8c.html#ab512b8f495325c7ea0f5a5a5d3f938eb">type</a>;</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    s-&gt;rlayer.wpend_ret = <a class="code" href="ct_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    <span class="comment">/* we now just need to write the buffer */</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="rec__layer__s3_8c.html#a740a746da04337932287b5c891f5408a">ssl3_write_pending</a>(s, type, buf, len, written);</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160; err:</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;}</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;</div><div class="line"><a name="l01117"></a><span class="lineno"><a class="line" href="record__locl_8h.html#a8a7e26d5d3fc9399cdaaebb051c51d15"> 1117</a></span>&#160;<a class="code" href="structDTLS1__BITMAP.html">DTLS1_BITMAP</a> *<a class="code" href="rec__layer__d1_8c.html#a8a7e26d5d3fc9399cdaaebb051c51d15">dtls1_get_bitmap</a>(SSL *s, <a class="code" href="structSSL3__RECORD.html">SSL3_RECORD</a> *rr,</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;                               <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *is_next_epoch)</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;{</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    *is_next_epoch = 0;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <span class="comment">/* In current epoch, accept HM, CCS, DATA, &amp; ALERT */</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <span class="keywordflow">if</span> (rr-&gt;<a class="code" href="structSSL3__RECORD.html#aa9d2cadf47d8209c657a3e128a17bf44">epoch</a> == s-&gt;rlayer.d-&gt;r_epoch)</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        <span class="keywordflow">return</span> &amp;s-&gt;rlayer.d-&gt;bitmap;</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="comment">     * Only HM and ALERT messages can be from the next epoch and only if we</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="comment">     * have already processed all of the unprocessed records from the last</span></div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="comment">     * epoch</span></div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rr-&gt;<a class="code" href="structSSL3__RECORD.html#aa9d2cadf47d8209c657a3e128a17bf44">epoch</a> == (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(s-&gt;rlayer.d-&gt;r_epoch + 1) &amp;&amp;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;             s-&gt;rlayer.d-&gt;unprocessed_rcds.epoch != s-&gt;rlayer.d-&gt;r_epoch &amp;&amp;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;             (rr-&gt;<a class="code" href="structSSL3__RECORD.html#ac765329451135abec74c45e1897abf26">type</a> == <a class="code" href="ssl3_8h.html#a913c4ab23166cbc9b67d6f759f7c87e5">SSL3_RT_HANDSHAKE</a> || rr-&gt;<a class="code" href="structSSL3__RECORD.html#ac765329451135abec74c45e1897abf26">type</a> == <a class="code" href="ssl3_8h.html#ac2ed784b96ecdc1d92d805793dd8a14c">SSL3_RT_ALERT</a>)) {</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;        *is_next_epoch = 1;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        <span class="keywordflow">return</span> &amp;s-&gt;rlayer.d-&gt;next_bitmap;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    }</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a>;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;}</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;</div><div class="line"><a name="l01142"></a><span class="lineno"><a class="line" href="record_8h.html#a84fc61d7bb3adb768528dca79e5a7cdf"> 1142</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="rec__layer__d1_8c.html#a84fc61d7bb3adb768528dca79e5a7cdf">dtls1_reset_seq_numbers</a>(SSL *s, <span class="keywordtype">int</span> rw)</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;{</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="bad__dtls__test_8c.html#a189930c4babdc38135a74db479534069">seq</a>;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> seq_bytes = <span class="keyword">sizeof</span>(s-&gt;rlayer.read_sequence);</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    <span class="keywordflow">if</span> (rw &amp; <a class="code" href="ssl3_8h.html#ae714280a93e6ebbf190053c62803f070">SSL3_CC_READ</a>) {</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        seq = s-&gt;rlayer.read_sequence;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        s-&gt;rlayer.d-&gt;r_epoch++;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        memcpy(&amp;s-&gt;rlayer.d-&gt;bitmap, &amp;s-&gt;rlayer.d-&gt;next_bitmap,</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;               <span class="keyword">sizeof</span>(s-&gt;rlayer.d-&gt;bitmap));</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        memset(&amp;s-&gt;rlayer.d-&gt;next_bitmap, 0, <span class="keyword">sizeof</span>(s-&gt;rlayer.d-&gt;next_bitmap));</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;<span class="comment">         * We must not use any buffered messages received from the previous</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="comment">         * epoch</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;        <a class="code" href="d1__lib_8c.html#a84c1b648778924395983222278762ebd">dtls1_clear_received_buffer</a>(s);</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        seq = s-&gt;rlayer.write_sequence;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        memcpy(s-&gt;rlayer.d-&gt;last_write_sequence, seq,</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;               <span class="keyword">sizeof</span>(s-&gt;rlayer.write_sequence));</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        s-&gt;rlayer.d-&gt;w_epoch++;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    }</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    memset(seq, 0, seq_bytes);</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;}</div><div class="ttc" id="statem_8c_html_a19ba352eaf7e02ce800b6a8332ff8170"><div class="ttname"><a href="statem_8c.html#a19ba352eaf7e02ce800b6a8332ff8170">ossl_statem_app_data_allowed</a></div><div class="ttdeci">int ossl_statem_app_data_allowed(SSL *s)</div><div class="ttdef"><b>Definition:</b> <a href="statem_8c_source.html#l00787">statem.c:787</a></div></div>
<div class="ttc" id="ssl_8h_html_a6984ab7dad158669c9617302e31bb669"><div class="ttname"><a href="ssl_8h.html#a6984ab7dad158669c9617302e31bb669">SSL_R_UNKNOWN_ALERT_TYPE</a></div><div class="ttdeci">#define SSL_R_UNKNOWN_ALERT_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l02632">ssl.h:2632</a></div></div>
<div class="ttc" id="ssl3_8h_html_a913c4ab23166cbc9b67d6f759f7c87e5"><div class="ttname"><a href="ssl3_8h.html#a913c4ab23166cbc9b67d6f759f7c87e5">SSL3_RT_HANDSHAKE</a></div><div class="ttdeci">#define SSL3_RT_HANDSHAKE</div><div class="ttdef"><b>Definition:</b> <a href="ssl3_8h_source.html#l00205">ssl3.h:205</a></div></div>
<div class="ttc" id="err_8c_html_a89d6b806fcd20c4ea07229451d489616"><div class="ttname"><a href="err_8c.html#a89d6b806fcd20c4ea07229451d489616">ERR_add_error_data</a></div><div class="ttdeci">void ERR_add_error_data(int num,...)</div><div class="ttdef"><b>Definition:</b> <a href="err_8c_source.html#l00700">err.c:700</a></div></div>
<div class="ttc" id="rsa_8h_html_a97173d49d4425d6ba54508bfe352412b"><div class="ttname"><a href="rsa_8h.html#a97173d49d4425d6ba54508bfe352412b">e</a></div><div class="ttdeci">int BIGNUM * e</div><div class="ttdef"><b>Definition:</b> <a href="rsa_8h_source.html#l00211">rsa.h:211</a></div></div>
<div class="ttc" id="ssl_8h_html_a8543e341fd503bc4bf3d1636af6634bf"><div class="ttname"><a href="ssl_8h.html#a8543e341fd503bc4bf3d1636af6634bf">SSL_R_APP_DATA_IN_HANDSHAKE</a></div><div class="ttdeci">#define SSL_R_APP_DATA_IN_HANDSHAKE</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l02396">ssl.h:2396</a></div></div>
<div class="ttc" id="bad__dtls__test_8c_html_a189930c4babdc38135a74db479534069"><div class="ttname"><a href="bad__dtls__test_8c.html#a189930c4babdc38135a74db479534069">seq</a></div><div class="ttdeci">unsigned long seq</div><div class="ttdef"><b>Definition:</b> <a href="bad__dtls__test_8c_source.html#l00431">bad_dtls_test.c:431</a></div></div>
<div class="ttc" id="structDTLS__RECORD__LAYER_html_a3b9c346ebe7a3f53056ee6837f9f928d"><div class="ttname"><a href="structDTLS__RECORD__LAYER.html#a3b9c346ebe7a3f53056ee6837f9f928d">DTLS_RECORD_LAYER::unprocessed_rcds</a></div><div class="ttdeci">record_pqueue unprocessed_rcds</div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00106">record.h:106</a></div></div>
<div class="ttc" id="crypto_8h_html_aeb21bb7e51c4f5af3bdce7226e52ca5a"><div class="ttname"><a href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a></div><div class="ttdeci">#define OPENSSL_free(addr)</div><div class="ttdef"><b>Definition:</b> <a href="crypto_8h_source.html#l00136">crypto.h:136</a></div></div>
<div class="ttc" id="structDTLS1__BITMAP_html"><div class="ttname"><a href="structDTLS1__BITMAP.html">DTLS1_BITMAP</a></div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00071">record.h:71</a></div></div>
<div class="ttc" id="record__locl_8h_html_a39fe92cc44402695055256f15008bde9"><div class="ttname"><a href="record__locl_8h.html#a39fe92cc44402695055256f15008bde9">dtls1_process_record</a></div><div class="ttdeci">int dtls1_process_record(SSL *s, DTLS1_BITMAP *bitmap)</div><div class="ttdef"><b>Definition:</b> <a href="ssl3__record_8c_source.html#l01370">ssl3_record.c:1370</a></div></div>
<div class="ttc" id="ssl_8h_html_a6fb6d4c2fc1439c2f4bea7153cfcc28bac9a4fca741223aadce221eb5c581146b"><div class="ttname"><a href="ssl_8h.html#a6fb6d4c2fc1439c2f4bea7153cfcc28bac9a4fca741223aadce221eb5c581146b">TLS_ST_CR_FINISHED</a></div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l00859">ssl.h:859</a></div></div>
<div class="ttc" id="ssl_8h_html_a6fb6d4c2fc1439c2f4bea7153cfcc28ba574295aa19d4135564cad6aea13df3a4"><div class="ttname"><a href="ssl_8h.html#a6fb6d4c2fc1439c2f4bea7153cfcc28ba574295aa19d4135564cad6aea13df3a4">TLS_ST_SR_FINISHED</a></div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l00880">ssl.h:880</a></div></div>
<div class="ttc" id="record__locl_8h_html_a8c444f18ca239c7708db48bbd23a5050"><div class="ttname"><a href="record__locl_8h.html#a8c444f18ca239c7708db48bbd23a5050">SSL3_BUFFER_set_offset</a></div><div class="ttdeci">#define SSL3_BUFFER_set_offset(b, o)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00067">record_locl.h:67</a></div></div>
<div class="ttc" id="ssl_8h_html_ad40cd015db83f7556027b0105995716f"><div class="ttname"><a href="ssl_8h.html#ad40cd015db83f7556027b0105995716f">SSL_CB_READ_ALERT</a></div><div class="ttdeci">#define SSL_CB_READ_ALERT</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l00916">ssl.h:916</a></div></div>
<div class="ttc" id="record__locl_8h_html_affb27a8abb328cbd177a9c50c4b47cfd"><div class="ttname"><a href="record__locl_8h.html#affb27a8abb328cbd177a9c50c4b47cfd">SSL3_BUFFER_set_left</a></div><div class="ttdeci">#define SSL3_BUFFER_set_left(b, l)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00064">record_locl.h:64</a></div></div>
<div class="ttc" id="record__locl_8h_html_a4fff0f254398dd21266e901e33c322a8"><div class="ttname"><a href="record__locl_8h.html#a4fff0f254398dd21266e901e33c322a8">SSL3_BUFFER_get_buf</a></div><div class="ttdeci">#define SSL3_BUFFER_get_buf(b)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00059">record_locl.h:59</a></div></div>
<div class="ttc" id="rec__layer__d1_8c_html_a7c4b07a1bdd29b9312d564597157f27e"><div class="ttname"><a href="rec__layer__d1_8c.html#a7c4b07a1bdd29b9312d564597157f27e">DTLS_RECORD_LAYER_resync_write</a></div><div class="ttdeci">void DTLS_RECORD_LAYER_resync_write(RECORD_LAYER *rl)</div><div class="ttdef"><b>Definition:</b> <a href="rec__layer__d1_8c_source.html#l00112">rec_layer_d1.c:112</a></div></div>
<div class="ttc" id="pqueue_8c_html_ab02c706ca2d314a5aedcc61d1574597e"><div class="ttname"><a href="pqueue_8c.html#ab02c706ca2d314a5aedcc61d1574597e">pqueue_new</a></div><div class="ttdeci">pqueue * pqueue_new()</div><div class="ttdef"><b>Definition:</b> <a href="pqueue_8c_source.html#l00037">pqueue.c:37</a></div></div>
<div class="ttc" id="ct_8h_html_ad8c3db4434e9cb5cd772cc009f40e856"><div class="ttname"><a href="ct_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a></div><div class="ttdeci">const unsigned char size_t len</div><div class="ttdef"><b>Definition:</b> <a href="ct_8h_source.html#l00346">ct.h:346</a></div></div>
<div class="ttc" id="pqueue_8c_html_a1c9b81e4391977030b98cc7e3c36aaf2"><div class="ttname"><a href="pqueue_8c.html#a1c9b81e4391977030b98cc7e3c36aaf2">pqueue_free</a></div><div class="ttdeci">void pqueue_free(pqueue *pq)</div><div class="ttdef"><b>Definition:</b> <a href="pqueue_8c_source.html#l00044">pqueue.c:44</a></div></div>
<div class="ttc" id="structDTLS__RECORD__LAYER_html_ac832ab1321fbf5ec9652cde74cbef3ae"><div class="ttname"><a href="structDTLS__RECORD__LAYER.html#ac832ab1321fbf5ec9652cde74cbef3ae">DTLS_RECORD_LAYER::last_write_sequence</a></div><div class="ttdeci">unsigned char last_write_sequence[8]</div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00123">record.h:123</a></div></div>
<div class="ttc" id="evp_8h_html_a789e2ef5a5767d4f6fd8b926ebb674e2"><div class="ttname"><a href="evp_8h.html#a789e2ef5a5767d4f6fd8b926ebb674e2">EVP_CIPH_CBC_MODE</a></div><div class="ttdeci">#define EVP_CIPH_CBC_MODE</div><div class="ttdef"><b>Definition:</b> <a href="evp_8h_source.html#l00225">evp.h:225</a></div></div>
<div class="ttc" id="pqueue_8c_html_ad6fd7f4360dedd4ae047f205dee7e1d2"><div class="ttname"><a href="pqueue_8c.html#ad6fd7f4360dedd4ae047f205dee7e1d2">pqueue_pop</a></div><div class="ttdeci">pitem * pqueue_pop(pqueue *pq)</div><div class="ttdef"><b>Definition:</b> <a href="pqueue_8c_source.html#l00090">pqueue.c:90</a></div></div>
<div class="ttc" id="structrecord__pqueue_html_a4624921f09f665c30d6825d559524469"><div class="ttname"><a href="structrecord__pqueue.html#a4624921f09f665c30d6825d559524469">record_pqueue::q</a></div><div class="ttdeci">struct pqueue_st * q</div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00080">record.h:80</a></div></div>
<div class="ttc" id="structDTLS__RECORD__LAYER_html"><div class="ttname"><a href="structDTLS__RECORD__LAYER.html">DTLS_RECORD_LAYER</a></div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00093">record.h:93</a></div></div>
<div class="ttc" id="rec__layer__d1_8c_html_ae9f785f5e3a92a95508165321bd04ee6"><div class="ttname"><a href="rec__layer__d1_8c.html#ae9f785f5e3a92a95508165321bd04ee6">dtls1_retrieve_buffered_record</a></div><div class="ttdeci">int dtls1_retrieve_buffered_record(SSL *s, record_pqueue *queue)</div><div class="ttdef"><b>Definition:</b> <a href="rec__layer__d1_8c_source.html#l00205">rec_layer_d1.c:205</a></div></div>
<div class="ttc" id="ssl__locl_8h_html_a52e9a6bd3aa3e6373d70a0dbcf069c77"><div class="ttname"><a href="ssl__locl_8h.html#a52e9a6bd3aa3e6373d70a0dbcf069c77">SSL_WRITE_ETM</a></div><div class="ttdeci">#define SSL_WRITE_ETM(s)</div><div class="ttdef"><b>Definition:</b> <a href="ssl__locl_8h_source.html#l00399">ssl_locl.h:399</a></div></div>
<div class="ttc" id="ssl_8h_html_a620f769f6a2c309539b068dd2c079442"><div class="ttname"><a href="ssl_8h.html#a620f769f6a2c309539b068dd2c079442">SSL_NOTHING</a></div><div class="ttdeci">#define SSL_NOTHING</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l00761">ssl.h:761</a></div></div>
<div class="ttc" id="evp_8h_html"><div class="ttname"><a href="evp_8h.html">evp.h</a></div></div>
<div class="ttc" id="ssl_8h_html_a68f2891a7debdcb21e853bb61e041ce2"><div class="ttname"><a href="ssl_8h.html#a68f2891a7debdcb21e853bb61e041ce2">SSL_R_COMPRESSION_FAILURE</a></div><div class="ttdeci">#define SSL_R_COMPRESSION_FAILURE</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l02443">ssl.h:2443</a></div></div>
<div class="ttc" id="ssl3_8h_html_a4ce048ea75d9ad44b578ec3fb731f674"><div class="ttname"><a href="ssl3_8h.html#a4ce048ea75d9ad44b578ec3fb731f674">SSL3_RT_HEADER</a></div><div class="ttdeci">#define SSL3_RT_HEADER</div><div class="ttdef"><b>Definition:</b> <a href="ssl3_8h_source.html#l00224">ssl3.h:224</a></div></div>
<div class="ttc" id="structDTLS__RECORD__LAYER_html_ac9de66909d66b507bdcb6ea5092f4b8f"><div class="ttname"><a href="structDTLS__RECORD__LAYER.html#ac9de66909d66b507bdcb6ea5092f4b8f">DTLS_RECORD_LAYER::curr_write_sequence</a></div><div class="ttdeci">unsigned char curr_write_sequence[8]</div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00124">record.h:124</a></div></div>
<div class="ttc" id="s3__msg_8c_html_a9e42a91e282847c50bd4cf748c5d4618"><div class="ttname"><a href="s3__msg_8c.html#a9e42a91e282847c50bd4cf748c5d4618">ssl3_send_alert</a></div><div class="ttdeci">int ssl3_send_alert(SSL *s, int level, int desc)</div><div class="ttdef"><b>Definition:</b> <a href="s3__msg_8c_source.html#l00063">s3_msg.c:63</a></div></div>
<div class="ttc" id="structRECORD__LAYER_html_a461df8119f9656fe77d397cee53ee0c4"><div class="ttname"><a href="structRECORD__LAYER.html#a461df8119f9656fe77d397cee53ee0c4">RECORD_LAYER::read_sequence</a></div><div class="ttdeci">unsigned char read_sequence[SEQ_NUM_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00177">record.h:177</a></div></div>
<div class="ttc" id="record__locl_8h_html_a26746fe96958cdc75ea4ac63bd3ede39"><div class="ttname"><a href="record__locl_8h.html#a26746fe96958cdc75ea4ac63bd3ede39">SSL3_RECORD_get_seq_num</a></div><div class="ttdeci">#define SSL3_RECORD_get_seq_num(r)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00093">record_locl.h:93</a></div></div>
<div class="ttc" id="ssl3_8h_html_a96e6f315f7fe97caf2634fb434700e25"><div class="ttname"><a href="ssl3_8h.html#a96e6f315f7fe97caf2634fb434700e25">SSL3_RT_APPLICATION_DATA</a></div><div class="ttdeci">#define SSL3_RT_APPLICATION_DATA</div><div class="ttdef"><b>Definition:</b> <a href="ssl3_8h_source.html#l00206">ssl3.h:206</a></div></div>
<div class="ttc" id="record__locl_8h_html_abda6657f9e5f0b2f714a98e2a82f3926"><div class="ttname"><a href="record__locl_8h.html#abda6657f9e5f0b2f714a98e2a82f3926">SSL3_RECORD_reset_input</a></div><div class="ttdeci">#define SSL3_RECORD_reset_input(r)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00092">record_locl.h:92</a></div></div>
<div class="ttc" id="pqueue_8c_html_aa637ea716e3bb8c38115dcbe5c84f11b"><div class="ttname"><a href="pqueue_8c.html#aa637ea716e3bb8c38115dcbe5c84f11b">pqueue_size</a></div><div class="ttdeci">size_t pqueue_size(pqueue *pq)</div><div class="ttdef"><b>Definition:</b> <a href="pqueue_8c_source.html#l00144">pqueue.c:144</a></div></div>
<div class="ttc" id="rec__layer__d1_8c_html_a6a3e98d5babadd66395c5ee66c3b8c51"><div class="ttname"><a href="rec__layer__d1_8c.html#a6a3e98d5babadd66395c5ee66c3b8c51">DTLS_RECORD_LAYER_free</a></div><div class="ttdeci">void DTLS_RECORD_LAYER_free(RECORD_LAYER *rl)</div><div class="ttdef"><b>Definition:</b> <a href="rec__layer__d1_8c_source.html#l00045">rec_layer_d1.c:45</a></div></div>
<div class="ttc" id="d1__lib_8c_html_a84c1b648778924395983222278762ebd"><div class="ttname"><a href="d1__lib_8c.html#a84c1b648778924395983222278762ebd">dtls1_clear_received_buffer</a></div><div class="ttdeci">void dtls1_clear_received_buffer(SSL *s)</div><div class="ttdef"><b>Definition:</b> <a href="d1__lib_8c_source.html#l00119">d1_lib.c:119</a></div></div>
<div class="ttc" id="ssl_8h_html_a1e7792c666f6445d5e67a561068b1b44"><div class="ttname"><a href="ssl_8h.html#a1e7792c666f6445d5e67a561068b1b44">SSL_F_DTLS1_PROCESS_BUFFERED_RECORDS</a></div><div class="ttdeci">#define SSL_F_DTLS1_PROCESS_BUFFERED_RECORDS</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l02104">ssl.h:2104</a></div></div>
<div class="ttc" id="ssl__locl_8h_html_af327758122fe033174d1d377bef3faa8"><div class="ttname"><a href="ssl__locl_8h.html#af327758122fe033174d1d377bef3faa8">dtls1_get_message_header</a></div><div class="ttdeci">void dtls1_get_message_header(unsigned char *data, struct hm_header_st *msg_hdr)</div><div class="ttdef"><b>Definition:</b> <a href="statem__dtls_8c_source.html#l01164">statem_dtls.c:1164</a></div></div>
<div class="ttc" id="rec__layer__d1_8c_html_afe163a60c037dffc406a999cdf4d733f"><div class="ttname"><a href="rec__layer__d1_8c.html#afe163a60c037dffc406a999cdf4d733f">DTLS_RECORD_LAYER_set_saved_w_epoch</a></div><div class="ttdeci">void DTLS_RECORD_LAYER_set_saved_w_epoch(RECORD_LAYER *rl, unsigned short e)</div><div class="ttdef"><b>Definition:</b> <a href="rec__layer__d1_8c_source.html#l00096">rec_layer_d1.c:96</a></div></div>
<div class="ttc" id="ssl_8h_html_afd5c90111dbeeb7667a62bbdf8337d98"><div class="ttname"><a href="ssl_8h.html#afd5c90111dbeeb7667a62bbdf8337d98">SSL_is_init_finished</a></div><div class="ttdeci">int SSL_is_init_finished(SSL *s)</div><div class="ttdef"><b>Definition:</b> <a href="statem_8c_source.html#l00074">statem.c:74</a></div></div>
<div class="ttc" id="record__locl_8h_html"><div class="ttname"><a href="record__locl_8h.html">record_locl.h</a></div></div>
<div class="ttc" id="bn_8h_html_a3440f8540faaec9c34da16295933680d"><div class="ttname"><a href="bn_8h.html#a3440f8540faaec9c34da16295933680d">cb</a></div><div class="ttdeci">int void(*) BN_CTX void *cb_arg int int const BIGNUM const BIGNUM BN_GENCB cb)</div><div class="ttdef"><b>Definition:</b> <a href="bn_8h_source.html#l00302">bn.h:302</a></div></div>
<div class="ttc" id="ssl__locl_8h_html_ab1b76f2c15a4cbb1072f22e247405417"><div class="ttname"><a href="ssl__locl_8h.html#ab1b76f2c15a4cbb1072f22e247405417">dtls1_retransmit_buffered_messages</a></div><div class="ttdeci">int dtls1_retransmit_buffered_messages(SSL *s)</div><div class="ttdef"><b>Definition:</b> <a href="statem__dtls_8c_source.html#l00949">statem_dtls.c:949</a></div></div>
<div class="ttc" id="openssl_2err_8h_html_ac863d0e29abbb6c480be6983fd48bf42"><div class="ttname"><a href="openssl_2err_8h.html#ac863d0e29abbb6c480be6983fd48bf42">ERR_R_INTERNAL_ERROR</a></div><div class="ttdeci">#define ERR_R_INTERNAL_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="openssl_2err_8h_source.html#l00190">err.h:190</a></div></div>
<div class="ttc" id="record__locl_8h_html_ab8fa0ea13a2529e8def561656f2f9d8e"><div class="ttname"><a href="record__locl_8h.html#ab8fa0ea13a2529e8def561656f2f9d8e">SSL3_RECORD_set_length</a></div><div class="ttdeci">#define SSL3_RECORD_set_length(r, l)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00085">record_locl.h:85</a></div></div>
<div class="ttc" id="record_8h_html_ade107ee5ac6b568af03b2475139041b0"><div class="ttname"><a href="record_8h.html#ade107ee5ac6b568af03b2475139041b0">ssl3_setup_buffers</a></div><div class="ttdeci">__owur int ssl3_setup_buffers(SSL *s)</div><div class="ttdef"><b>Definition:</b> <a href="ssl3__buffer_8c_source.html#l00129">ssl3_buffer.c:129</a></div></div>
<div class="ttc" id="structDTLS__RECORD__LAYER_html_a3b9e5d3a9658a6a92596f38a866496d0"><div class="ttname"><a href="structDTLS__RECORD__LAYER.html#a3b9e5d3a9658a6a92596f38a866496d0">DTLS_RECORD_LAYER::buffered_app_data</a></div><div class="ttdeci">record_pqueue buffered_app_data</div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00113">record.h:113</a></div></div>
<div class="ttc" id="evp_8h_html_ab85ceaeb1a86e13bf1c58f2f0a962a39"><div class="ttname"><a href="evp_8h.html#ab85ceaeb1a86e13bf1c58f2f0a962a39">EVP_CIPH_CCM_MODE</a></div><div class="ttdeci">#define EVP_CIPH_CCM_MODE</div><div class="ttdef"><b>Definition:</b> <a href="evp_8h_source.html#l00230">evp.h:230</a></div></div>
<div class="ttc" id="structRECORD__LAYER_html_ab791e525d7d88c4e178d69a01f41b3a8"><div class="ttname"><a href="structRECORD__LAYER.html#ab791e525d7d88c4e178d69a01f41b3a8">RECORD_LAYER::d</a></div><div class="ttdeci">DTLS_RECORD_LAYER * d</div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00183">record.h:183</a></div></div>
<div class="ttc" id="record__locl_8h_html_a493142fdfb3ea2f1b7417c057790d623"><div class="ttname"><a href="record__locl_8h.html#a493142fdfb3ea2f1b7417c057790d623">SSL3_BUFFER_is_initialised</a></div><div class="ttdeci">#define SSL3_BUFFER_is_initialised(b)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00069">record_locl.h:69</a></div></div>
<div class="ttc" id="record__locl_8h_html_aa55011b6b9147d3d12a5c9512c9e23fd"><div class="ttname"><a href="record__locl_8h.html#aa55011b6b9147d3d12a5c9512c9e23fd">SSL3_RECORD_get_data</a></div><div class="ttdeci">#define SSL3_RECORD_get_data(r)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00088">record_locl.h:88</a></div></div>
<div class="ttc" id="ct__locl_8h_html_a11fe10daafbfb28a38ba46f7213a225f"><div class="ttname"><a href="ct__locl_8h.html#a11fe10daafbfb28a38ba46f7213a225f">s2n</a></div><div class="ttdeci">#define s2n(s, c)</div><div class="ttdef"><b>Definition:</b> <a href="ct__locl_8h_source.html#l00031">ct_locl.h:31</a></div></div>
<div class="ttc" id="evp_8h_html_a88edfa13679e5e1360836f8833b3032b"><div class="ttname"><a href="evp_8h.html#a88edfa13679e5e1360836f8833b3032b">EVP_CIPH_GCM_MODE</a></div><div class="ttdeci">#define EVP_CIPH_GCM_MODE</div><div class="ttdef"><b>Definition:</b> <a href="evp_8h_source.html#l00229">evp.h:229</a></div></div>
<div class="ttc" id="structDTLS1__RECORD__DATA_html_a12f869e80da40cc0807ed2dddd5ff95e"><div class="ttname"><a href="structDTLS1__RECORD__DATA.html#a12f869e80da40cc0807ed2dddd5ff95e">DTLS1_RECORD_DATA::packet</a></div><div class="ttdeci">unsigned char * packet</div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00084">record.h:84</a></div></div>
<div class="ttc" id="dtls1_8h_html_a0b67a04e169539f32cbc3c4951f4340a"><div class="ttname"><a href="dtls1_8h.html#a0b67a04e169539f32cbc3c4951f4340a">DTLS1_AL_HEADER_LENGTH</a></div><div class="ttdeci">#define DTLS1_AL_HEADER_LENGTH</div><div class="ttdef"><b>Definition:</b> <a href="dtls1_8h_source.html#l00043">dtls1.h:43</a></div></div>
<div class="ttc" id="dtls1_8h_html_a078aed34c9324a49ad7299654038b127"><div class="ttname"><a href="dtls1_8h.html#a078aed34c9324a49ad7299654038b127">DTLS1_BAD_VER</a></div><div class="ttdeci">#define DTLS1_BAD_VER</div><div class="ttdef"><b>Definition:</b> <a href="dtls1_8h_source.html#l00023">dtls1.h:23</a></div></div>
<div class="ttc" id="ssl_8h_html_a539e12043296c284530cd83ca682298e"><div class="ttname"><a href="ssl_8h.html#a539e12043296c284530cd83ca682298e">SSL_F_DTLS1_BUFFER_RECORD</a></div><div class="ttdeci">#define SSL_F_DTLS1_BUFFER_RECORD</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l02100">ssl.h:2100</a></div></div>
<div class="ttc" id="dtls1_8h_html_a7065450667dc936dd5c2b02a51000a30"><div class="ttname"><a href="dtls1_8h.html#a7065450667dc936dd5c2b02a51000a30">DTLS1_RT_HEADER_LENGTH</a></div><div class="ttdeci">#define DTLS1_RT_HEADER_LENGTH</div><div class="ttdef"><b>Definition:</b> <a href="dtls1_8h_source.html#l00031">dtls1.h:31</a></div></div>
<div class="ttc" id="ssl_8h_html_aece45de10e6d3afe21bd0ec3bc49f100"><div class="ttname"><a href="ssl_8h.html#aece45de10e6d3afe21bd0ec3bc49f100">SSL_get_state</a></div><div class="ttdeci">__owur OSSL_HANDSHAKE_STATE SSL_get_state(const SSL *ssl)</div><div class="ttdef"><b>Definition:</b> <a href="statem_8c_source.html#l00064">statem.c:64</a></div></div>
<div class="ttc" id="dtls1__bitmap_8c_html_a48f1bf809e7ba5db6a2048f4976d93eb"><div class="ttname"><a href="dtls1__bitmap_8c.html#a48f1bf809e7ba5db6a2048f4976d93eb">dtls1_record_replay_check</a></div><div class="ttdeci">int dtls1_record_replay_check(SSL *s, DTLS1_BITMAP *bitmap)</div><div class="ttdef"><b>Definition:</b> <a href="dtls1__bitmap_8c_source.html#l00038">dtls1_bitmap.c:38</a></div></div>
<div class="ttc" id="tls1_8h_html_af767b3a75f9ad21c9b6ab961add3bfec"><div class="ttname"><a href="tls1_8h.html#af767b3a75f9ad21c9b6ab961add3bfec">TLS1_VERSION</a></div><div class="ttdeci">#define TLS1_VERSION</div><div class="ttdef"><b>Definition:</b> <a href="tls1_8h_source.html#l00065">tls1.h:65</a></div></div>
<div class="ttc" id="record__locl_8h_html_aba566fdce9a72316d621a22cb20b7bab"><div class="ttname"><a href="record__locl_8h.html#aba566fdce9a72316d621a22cb20b7bab">ssl3_do_compress</a></div><div class="ttdeci">__owur int ssl3_do_compress(SSL *ssl, SSL3_RECORD *wr)</div><div class="ttdef"><b>Definition:</b> <a href="ssl3__record_8c_source.html#l00616">ssl3_record.c:616</a></div></div>
<div class="ttc" id="e__aes_8c_html_ab512b8f495325c7ea0f5a5a5d3f938eb"><div class="ttname"><a href="e__aes_8c.html#ab512b8f495325c7ea0f5a5a5d3f938eb">type</a></div><div class="ttdeci">EVP_CIPH_FLAG_AEAD_CIPHER CUSTOM_FLAGS int type</div><div class="ttdef"><b>Definition:</b> <a href="e__aes_8c_source.html#l01778">e_aes.c:1778</a></div></div>
<div class="ttc" id="record__locl_8h_html_a3690c828023760bce180d8f047226022"><div class="ttname"><a href="record__locl_8h.html#a3690c828023760bce180d8f047226022">SSL3_RECORD_set_type</a></div><div class="ttdeci">#define SSL3_RECORD_set_type(r, t)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00083">record_locl.h:83</a></div></div>
<div class="ttc" id="ssl_8h_html_a384de8eaf47464df5c2b7ff1c281995d"><div class="ttname"><a href="ssl_8h.html#a384de8eaf47464df5c2b7ff1c281995d">SSL_MODE_AUTO_RETRY</a></div><div class="ttdeci">#define SSL_MODE_AUTO_RETRY</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l00387">ssl.h:387</a></div></div>
<div class="ttc" id="structhm__header__st_html"><div class="ttname"><a href="structhm__header__st.html">hm_header_st</a></div><div class="ttdef"><b>Definition:</b> <a href="ssl__locl_8h_source.html#l01420">ssl_locl.h:1420</a></div></div>
<div class="ttc" id="ssl_8h_html_acc867649d6aac0f6cbea1ea8ff213a50"><div class="ttname"><a href="ssl_8h.html#acc867649d6aac0f6cbea1ea8ff213a50">SSL_RECEIVED_SHUTDOWN</a></div><div class="ttdeci">#define SSL_RECEIVED_SHUTDOWN</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l00208">ssl.h:208</a></div></div>
<div class="ttc" id="ssl3_8h_html_ad961b12ab367d2832c377e1425d06684"><div class="ttname"><a href="ssl3_8h.html#ad961b12ab367d2832c377e1425d06684">SSL3_MT_FINISHED</a></div><div class="ttdeci">#define SSL3_MT_FINISHED</div><div class="ttdef"><b>Definition:</b> <a href="ssl3_8h_source.html#l00288">ssl3.h:288</a></div></div>
<div class="ttc" id="record__locl_8h_html_a3ad663c2b589f8e007f99e3e402c330e"><div class="ttname"><a href="record__locl_8h.html#a3ad663c2b589f8e007f99e3e402c330e">SSL3_RECORD_get_type</a></div><div class="ttdeci">#define SSL3_RECORD_get_type(r)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00082">record_locl.h:82</a></div></div>
<div class="ttc" id="record_8h_html_ace5daf28516639bf2395ae48b5f6ba95"><div class="ttname"><a href="record_8h.html#ace5daf28516639bf2395ae48b5f6ba95">SEQ_NUM_SIZE</a></div><div class="ttdeci">#define SEQ_NUM_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00030">record.h:30</a></div></div>
<div class="ttc" id="record__locl_8h_html_ab865bec33496b20b20576edc81dd1c65"><div class="ttname"><a href="record__locl_8h.html#ab865bec33496b20b20576edc81dd1c65">SSL3_RECORD_sub_length</a></div><div class="ttdeci">#define SSL3_RECORD_sub_length(r, l)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00087">record_locl.h:87</a></div></div>
<div class="ttc" id="rec__layer__d1_8c_html_a152e40dd2a65f190a77801a5fbe5544f"><div class="ttname"><a href="rec__layer__d1_8c.html#a152e40dd2a65f190a77801a5fbe5544f">dtls1_process_buffered_records</a></div><div class="ttdeci">int dtls1_process_buffered_records(SSL *s)</div><div class="ttdef"><b>Definition:</b> <a href="rec__layer__d1_8c_source.html#l00230">rec_layer_d1.c:230</a></div></div>
<div class="ttc" id="ssl_8h_html_a70b42e45c1dadd37c0e74b9b21393e26"><div class="ttname"><a href="ssl_8h.html#a70b42e45c1dadd37c0e74b9b21393e26">SSL_AD_ILLEGAL_PARAMETER</a></div><div class="ttdeci">#define SSL_AD_ILLEGAL_PARAMETER</div></div>
<div class="ttc" id="rec__layer__s3_8c_html_a6a254a140e0603e963817febf308f928"><div class="ttname"><a href="rec__layer__s3_8c.html#a6a254a140e0603e963817febf308f928">ssl3_record_sequence_update</a></div><div class="ttdeci">void ssl3_record_sequence_update(unsigned char *seq)</div><div class="ttdef"><b>Definition:</b> <a href="rec__layer__s3_8c_source.html#l01585">rec_layer_s3.c:1585</a></div></div>
<div class="ttc" id="openssl_2bio_8h_html_ab5e0136b62a0730d3f9b27c9d74c8ddc"><div class="ttname"><a href="openssl_2bio_8h.html#ab5e0136b62a0730d3f9b27c9d74c8ddc">BIO_CTRL_DGRAM_SCTP_GET_RCVINFO</a></div><div class="ttdeci">#define BIO_CTRL_DGRAM_SCTP_GET_RCVINFO</div><div class="ttdef"><b>Definition:</b> <a href="openssl_2bio_8h_source.html#l00142">bio.h:142</a></div></div>
<div class="ttc" id="rec__layer__d1_8c_html_afafdddaa7c8acabaed11ef8e81620aab"><div class="ttname"><a href="rec__layer__d1_8c.html#afafdddaa7c8acabaed11ef8e81620aab">do_dtls1_write</a></div><div class="ttdeci">int do_dtls1_write(SSL *s, int type, const unsigned char *buf, size_t len, int create_empty_fragment, size_t *written)</div><div class="ttdef"><b>Definition:</b> <a href="rec__layer__d1_8c_source.html#l00916">rec_layer_d1.c:916</a></div></div>
<div class="ttc" id="ssl3_8h_html_ae54807cec33243767b2d18ec1e4dc290"><div class="ttname"><a href="ssl3_8h.html#ae54807cec33243767b2d18ec1e4dc290">SSL3_RT_CHANGE_CIPHER_SPEC</a></div><div class="ttdeci">#define SSL3_RT_CHANGE_CIPHER_SPEC</div><div class="ttdef"><b>Definition:</b> <a href="ssl3_8h_source.html#l00203">ssl3.h:203</a></div></div>
<div class="ttc" id="ssl_8h_html_a73d206f471bf26c595be8d2ecae9722c"><div class="ttname"><a href="ssl_8h.html#a73d206f471bf26c595be8d2ecae9722c">SSL_R_TOO_MANY_WARN_ALERTS</a></div><div class="ttdeci">#define SSL_R_TOO_MANY_WARN_ALERTS</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l02624">ssl.h:2624</a></div></div>
<div class="ttc" id="pqueue_8c_html_a3af216a259925f97503fb0f60a153899"><div class="ttname"><a href="pqueue_8c.html#a3af216a259925f97503fb0f60a153899">pqueue_insert</a></div><div class="ttdeci">pitem * pqueue_insert(pqueue *pq, pitem *item)</div><div class="ttdef"><b>Definition:</b> <a href="pqueue_8c_source.html#l00049">pqueue.c:49</a></div></div>
<div class="ttc" id="record__locl_8h_html_a2d62c9700244c0c268c614b04bab75a2"><div class="ttname"><a href="record__locl_8h.html#a2d62c9700244c0c268c614b04bab75a2">dtls1_get_record</a></div><div class="ttdeci">__owur int dtls1_get_record(SSL *s)</div><div class="ttdef"><b>Definition:</b> <a href="ssl3__record_8c_source.html#l01585">ssl3_record.c:1585</a></div></div>
<div class="ttc" id="evp_8h_html_a227ab179b4712a4f47e5a053e9b80585"><div class="ttname"><a href="evp_8h.html#a227ab179b4712a4f47e5a053e9b80585">EVP_CIPHER_CTX_mode</a></div><div class="ttdeci">#define EVP_CIPHER_CTX_mode(c)</div><div class="ttdef"><b>Definition:</b> <a href="evp_8h_source.html#l00477">evp.h:477</a></div></div>
<div class="ttc" id="ssl3_8h_html_aa5675bd7936c6fef8f9b5b2cea8f0baf"><div class="ttname"><a href="ssl3_8h.html#aa5675bd7936c6fef8f9b5b2cea8f0baf">SSL3_RT_MAX_PLAIN_LENGTH</a></div><div class="ttdeci">#define SSL3_RT_MAX_PLAIN_LENGTH</div><div class="ttdef"><b>Definition:</b> <a href="ssl3_8h_source.html#l00164">ssl3.h:164</a></div></div>
<div class="ttc" id="dtls1_8h_html_a49ab36464030dc24b1922d8cbc66266b"><div class="ttname"><a href="dtls1_8h.html#a49ab36464030dc24b1922d8cbc66266b">DTLS1_VERSION</a></div><div class="ttdeci">#define DTLS1_VERSION</div><div class="ttdef"><b>Definition:</b> <a href="dtls1_8h_source.html#l00017">dtls1.h:17</a></div></div>
<div class="ttc" id="rec__layer__d1_8c_html_a8a4b0d98035960d83b7ce1eca37b1dd6"><div class="ttname"><a href="rec__layer__d1_8c.html#a8a4b0d98035960d83b7ce1eca37b1dd6">DTLS_RECORD_LAYER_set_write_sequence</a></div><div class="ttdeci">void DTLS_RECORD_LAYER_set_write_sequence(RECORD_LAYER *rl, unsigned char *seq)</div><div class="ttdef"><b>Definition:</b> <a href="rec__layer__d1_8c_source.html#l00117">rec_layer_d1.c:117</a></div></div>
<div class="ttc" id="ssl__locl_8h_html_ad0a3f3b8c4b9f8c9dfd63c0cf0e7b34a"><div class="ttname"><a href="ssl__locl_8h.html#ad0a3f3b8c4b9f8c9dfd63c0cf0e7b34a">n2l3</a></div><div class="ttdeci">#define n2l3(c, l)</div><div class="ttdef"><b>Definition:</b> <a href="ssl__locl_8h_source.html#l00160">ssl_locl.h:160</a></div></div>
<div class="ttc" id="record__locl_8h_html_a2ed0d41ecc44677103540cc5ab800b63"><div class="ttname"><a href="record__locl_8h.html#a2ed0d41ecc44677103540cc5ab800b63">RECORD_LAYER_get_rbuf</a></div><div class="ttdeci">#define RECORD_LAYER_get_rbuf(rl)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00021">record_locl.h:21</a></div></div>
<div class="ttc" id="statem_8c_html_a21ec74f54ef5c0f0543304b2ec35f762"><div class="ttname"><a href="statem_8c.html#a21ec74f54ef5c0f0543304b2ec35f762">ossl_statem_get_in_handshake</a></div><div class="ttdeci">int ossl_statem_get_in_handshake(SSL *s)</div><div class="ttdef"><b>Definition:</b> <a href="statem_8c_source.html#l00141">statem.c:141</a></div></div>
<div class="ttc" id="openssl_2bio_8h_html_a116e3d4381163644299656218d9c6112"><div class="ttname"><a href="openssl_2bio_8h.html#a116e3d4381163644299656218d9c6112">BIO_clear_retry_flags</a></div><div class="ttdeci">#define BIO_clear_retry_flags(b)</div><div class="ttdef"><b>Definition:</b> <a href="openssl_2bio_8h_source.html#l00195">bio.h:195</a></div></div>
<div class="ttc" id="bio__lib_8c_html_af91d25b1b326df959b3b5d05a1891577"><div class="ttname"><a href="bio__lib_8c.html#af91d25b1b326df959b3b5d05a1891577">BIO_ctrl</a></div><div class="ttdeci">long BIO_ctrl(BIO *b, int cmd, long larg, void *parg)</div><div class="ttdef"><b>Definition:</b> <a href="bio__lib_8c_source.html#l00509">bio_lib.c:509</a></div></div>
<div class="ttc" id="structDTLS1__RECORD__DATA_html_a4f4654e61a104fc84503bb658507d673"><div class="ttname"><a href="structDTLS1__RECORD__DATA.html#a4f4654e61a104fc84503bb658507d673">DTLS1_RECORD_DATA::rrec</a></div><div class="ttdeci">SSL3_RECORD rrec</div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00087">record.h:87</a></div></div>
<div class="ttc" id="ssl__locl_8h_html_ad01b818045bf1cef5f0af7fc25aa3b59"><div class="ttname"><a href="ssl__locl_8h.html#ad01b818045bf1cef5f0af7fc25aa3b59">dtls1_retransmit_message</a></div><div class="ttdeci">__owur int dtls1_retransmit_message(SSL *s, unsigned short seq, int *found)</div><div class="ttdef"><b>Definition:</b> <a href="statem__dtls_8c_source.html#l01035">statem_dtls.c:1035</a></div></div>
<div class="ttc" id="evp__lib_8c_html_af3201d12bcf0e13a885ca4cf5ee379f3"><div class="ttname"><a href="evp__lib_8c.html#af3201d12bcf0e13a885ca4cf5ee379f3">EVP_CIPHER_CTX_iv_length</a></div><div class="ttdeci">int EVP_CIPHER_CTX_iv_length(const EVP_CIPHER_CTX *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="evp__lib_8c_source.html#l00231">evp_lib.c:231</a></div></div>
<div class="ttc" id="ssl__locl_8h_html_afe783848d7ab27160fb314a3934d8a1e"><div class="ttname"><a href="ssl__locl_8h.html#afe783848d7ab27160fb314a3934d8a1e">dtls1_read_failed</a></div><div class="ttdeci">__owur int dtls1_read_failed(SSL *s, int code)</div><div class="ttdef"><b>Definition:</b> <a href="statem__dtls_8c_source.html#l00910">statem_dtls.c:910</a></div></div>
<div class="ttc" id="pqueue_8c_html_a7bf585ee203902b922fdda8a49e80f8d"><div class="ttname"><a href="pqueue_8c.html#a7bf585ee203902b922fdda8a49e80f8d">pqueue_peek</a></div><div class="ttdeci">pitem * pqueue_peek(pqueue *pq)</div><div class="ttdef"><b>Definition:</b> <a href="pqueue_8c_source.html#l00085">pqueue.c:85</a></div></div>
<div class="ttc" id="openssl_2err_8h_html_a85650ea112d3012313596df1cb1b7760"><div class="ttname"><a href="openssl_2err_8h.html#a85650ea112d3012313596df1cb1b7760">SSLerr</a></div><div class="ttdeci">#define SSLerr(f, r)</div><div class="ttdef"><b>Definition:</b> <a href="openssl_2err_8h_source.html#l00113">err.h:113</a></div></div>
<div class="ttc" id="b__print_8c_html_a81ca789053c48a3b5201d3dc2431b0dd"><div class="ttname"><a href="b__print_8c.html#a81ca789053c48a3b5201d3dc2431b0dd">BIO_snprintf</a></div><div class="ttdeci">int BIO_snprintf(char *buf, size_t n, const char *format,...)</div><div class="ttdef"><b>Definition:</b> <a href="b__print_8c_source.html#l00913">b_print.c:913</a></div></div>
<div class="ttc" id="structDTLS1__RECORD__DATA_html_a0089d43b7c64e871febcfe7a79ce286d"><div class="ttname"><a href="structDTLS1__RECORD__DATA.html#a0089d43b7c64e871febcfe7a79ce286d">DTLS1_RECORD_DATA::recordinfo</a></div><div class="ttdeci">struct bio_dgram_sctp_rcvinfo recordinfo</div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00089">record.h:89</a></div></div>
<div class="ttc" id="structSSL3__RECORD_html_ac24cea2bfcc927fd29bc74d1086707d8"><div class="ttname"><a href="structSSL3__RECORD.html#ac24cea2bfcc927fd29bc74d1086707d8">SSL3_RECORD::data</a></div><div class="ttdeci">unsigned char * data</div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00053">record.h:53</a></div></div>
<div class="ttc" id="ssl_8h_html_a9242201b2900a585b4c459cdb188c8e0"><div class="ttname"><a href="ssl_8h.html#a9242201b2900a585b4c459cdb188c8e0">SSL_R_UNEXPECTED_RECORD</a></div><div class="ttdeci">#define SSL_R_UNEXPECTED_RECORD</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l02630">ssl.h:2630</a></div></div>
<div class="ttc" id="pqueue_8c_html_a9cf666037bccc254a6799b9f65ad663b"><div class="ttname"><a href="pqueue_8c.html#a9cf666037bccc254a6799b9f65ad663b">pitem_new</a></div><div class="ttdeci">pitem * pitem_new(unsigned char *prio64be, void *data)</div><div class="ttdef"><b>Definition:</b> <a href="pqueue_8c_source.html#l00018">pqueue.c:18</a></div></div>
<div class="ttc" id="record__locl_8h_html_ae02c202b74534697d0095217528f60c7"><div class="ttname"><a href="record__locl_8h.html#ae02c202b74534697d0095217528f60c7">SSL3_RECORD_get_off</a></div><div class="ttdeci">#define SSL3_RECORD_get_off(r)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00094">record_locl.h:94</a></div></div>
<div class="ttc" id="structrecord__pqueue_html"><div class="ttname"><a href="structrecord__pqueue.html">record_pqueue</a></div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00078">record.h:78</a></div></div>
<div class="ttc" id="structDTLS1__RECORD__DATA_html"><div class="ttname"><a href="structDTLS1__RECORD__DATA.html">DTLS1_RECORD_DATA</a></div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00083">record.h:83</a></div></div>
<div class="ttc" id="record__locl_8h_html_ab27d3a5679c9417d842f23d5b6fb973a"><div class="ttname"><a href="record__locl_8h.html#ab27d3a5679c9417d842f23d5b6fb973a">SSL3_RECORD_add_length</a></div><div class="ttdeci">#define SSL3_RECORD_add_length(r, l)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00086">record_locl.h:86</a></div></div>
<div class="ttc" id="structSSL3__RECORD_html_ac765329451135abec74c45e1897abf26"><div class="ttname"><a href="structSSL3__RECORD.html#ac765329451135abec74c45e1897abf26">SSL3_RECORD::type</a></div><div class="ttdeci">int type</div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00038">record.h:38</a></div></div>
<div class="ttc" id="openssl_2bio_8h_html_a46f7810f041c1d804d87bb073dccc45f"><div class="ttname"><a href="openssl_2bio_8h.html#a46f7810f041c1d804d87bb073dccc45f">BIO_CTRL_DGRAM_SCTP_SET_RCVINFO</a></div><div class="ttdeci">#define BIO_CTRL_DGRAM_SCTP_SET_RCVINFO</div><div class="ttdef"><b>Definition:</b> <a href="openssl_2bio_8h_source.html#l00143">bio.h:143</a></div></div>
<div class="ttc" id="openssl_2bio_8h_html_af5f66c03eb3665ce8f37c3d08e4e7818"><div class="ttname"><a href="openssl_2bio_8h.html#af5f66c03eb3665ce8f37c3d08e4e7818">BIO_set_retry_read</a></div><div class="ttdeci">#define BIO_set_retry_read(b)</div><div class="ttdef"><b>Definition:</b> <a href="openssl_2bio_8h_source.html#l00189">bio.h:189</a></div></div>
<div class="ttc" id="evp__lib_8c_html_a71fed39076aec9a43d618177317e3691"><div class="ttname"><a href="evp__lib_8c.html#a71fed39076aec9a43d618177317e3691">EVP_MD_CTX_md</a></div><div class="ttdeci">const EVP_MD * EVP_MD_CTX_md(const EVP_MD_CTX *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="evp__lib_8c_source.html#l00439">evp_lib.c:439</a></div></div>
<div class="ttc" id="structSSL3__BUFFER_html"><div class="ttname"><a href="structSSL3__BUFFER.html">SSL3_BUFFER</a></div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00017">record.h:17</a></div></div>
<div class="ttc" id="ssl_8h_html_a4ac2fe10be63807edcd8ce6b4cbf846e"><div class="ttname"><a href="ssl_8h.html#a4ac2fe10be63807edcd8ce6b4cbf846e">SSL_ST_READ_HEADER</a></div><div class="ttdeci">#define SSL_ST_READ_HEADER</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l00936">ssl.h:936</a></div></div>
<div class="ttc" id="structDTLS1__RECORD__DATA_html_a9a1d2af51256a2a27b1b5b12d3b8e6ee"><div class="ttname"><a href="structDTLS1__RECORD__DATA.html#a9a1d2af51256a2a27b1b5b12d3b8e6ee">DTLS1_RECORD_DATA::rbuf</a></div><div class="ttdeci">SSL3_BUFFER rbuf</div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00086">record.h:86</a></div></div>
<div class="ttc" id="record__locl_8h_html_a5bd4a7019a6a2cb8cdef9dcddd5f7c73"><div class="ttname"><a href="record__locl_8h.html#a5bd4a7019a6a2cb8cdef9dcddd5f7c73">SSL3_RECORD_set_off</a></div><div class="ttdeci">#define SSL3_RECORD_set_off(r, o)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00095">record_locl.h:95</a></div></div>
<div class="ttc" id="structDTLS__RECORD__LAYER_html_a07f814f5c84eeeb5692055b2ca77bc02"><div class="ttname"><a href="structDTLS__RECORD__LAYER.html#a07f814f5c84eeeb5692055b2ca77bc02">DTLS_RECORD_LAYER::w_epoch</a></div><div class="ttdeci">unsigned short w_epoch</div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00100">record.h:100</a></div></div>
<div class="ttc" id="ssl_8h_html_ad518421573c23757abb58d60cf291804"><div class="ttname"><a href="ssl_8h.html#ad518421573c23757abb58d60cf291804">SSL_AD_INTERNAL_ERROR</a></div><div class="ttdeci">#define SSL_AD_INTERNAL_ERROR</div></div>
<div class="ttc" id="record__locl_8h_html_a3bc732da7a4862bbe72cf436f28643e1"><div class="ttname"><a href="record__locl_8h.html#a3bc732da7a4862bbe72cf436f28643e1">SSL3_BUFFER_release</a></div><div class="ttdeci">void SSL3_BUFFER_release(SSL3_BUFFER *b)</div><div class="ttdef"><b>Definition:</b> <a href="ssl3__buffer_8c_source.html#l00031">ssl3_buffer.c:31</a></div></div>
<div class="ttc" id="ssl__locl_8h_html_ac4a8703cf10b6dedb432310701ecc58e"><div class="ttname"><a href="ssl__locl_8h.html#ac4a8703cf10b6dedb432310701ecc58e">dtls1_get_queue_priority</a></div><div class="ttdeci">__owur int dtls1_get_queue_priority(unsigned short seq, int is_ccs)</div><div class="ttdef"><b>Definition:</b> <a href="statem__dtls_8c_source.html#l00934">statem_dtls.c:934</a></div></div>
<div class="ttc" id="structDTLS__RECORD__LAYER_html_a987fed78e6be6e293938b2a5f5de5ab8"><div class="ttname"><a href="structDTLS__RECORD__LAYER.html#a987fed78e6be6e293938b2a5f5de5ab8">DTLS_RECORD_LAYER::processed_rcds</a></div><div class="ttdeci">record_pqueue processed_rcds</div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00107">record.h:107</a></div></div>
<div class="ttc" id="record__locl_8h_html_a43aa25a3541ec764acc3e9cd322f9633"><div class="ttname"><a href="record__locl_8h.html#a43aa25a3541ec764acc3e9cd322f9633">SSL3_RECORD_set_input</a></div><div class="ttdeci">#define SSL3_RECORD_set_input(r, i)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00091">record_locl.h:91</a></div></div>
<div class="ttc" id="pqueue_8c_html_aaf7c05ae52d91d8936012d52f58b584f"><div class="ttname"><a href="pqueue_8c.html#aaf7c05ae52d91d8936012d52f58b584f">pitem_free</a></div><div class="ttdeci">void pitem_free(pitem *item)</div><div class="ttdef"><b>Definition:</b> <a href="pqueue_8c_source.html#l00032">pqueue.c:32</a></div></div>
<div class="ttc" id="rec__layer__d1_8c_html_a1c19d4078df3d94d67588ec1a572d87e"><div class="ttname"><a href="rec__layer__d1_8c.html#a1c19d4078df3d94d67588ec1a572d87e">DTLS_RECORD_LAYER_new</a></div><div class="ttdeci">int DTLS_RECORD_LAYER_new(RECORD_LAYER *rl)</div><div class="ttdef"><b>Definition:</b> <a href="rec__layer__d1_8c_source.html#l00019">rec_layer_d1.c:19</a></div></div>
<div class="ttc" id="record__locl_8h_html_af1d036179208c95e57e4399754f63708"><div class="ttname"><a href="record__locl_8h.html#af1d036179208c95e57e4399754f63708">SSL3_RECORD_get_epoch</a></div><div class="ttdeci">#define SSL3_RECORD_get_epoch(r)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00097">record_locl.h:97</a></div></div>
<div class="ttc" id="rec__layer__d1_8c_html_a900d0426fe39d6d554769c25bb57ff7b"><div class="ttname"><a href="rec__layer__d1_8c.html#a900d0426fe39d6d554769c25bb57ff7b">dtls1_buffer_record</a></div><div class="ttdeci">int dtls1_buffer_record(SSL *s, record_pqueue *queue, unsigned char *priority)</div><div class="ttdef"><b>Definition:</b> <a href="rec__layer__d1_8c_source.html#l00145">rec_layer_d1.c:145</a></div></div>
<div class="ttc" id="ssl_8h_html_a0ee9b6da591dcba0f6900e6013d2fb3e"><div class="ttname"><a href="ssl_8h.html#a0ee9b6da591dcba0f6900e6013d2fb3e">SSL_F_DO_DTLS1_WRITE</a></div><div class="ttdeci">#define SSL_F_DO_DTLS1_WRITE</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l02098">ssl.h:2098</a></div></div>
<div class="ttc" id="rec__layer__d1_8c_html_aaa9f6b1c214407dc9dd22000b06f9296"><div class="ttname"><a href="rec__layer__d1_8c.html#aaa9f6b1c214407dc9dd22000b06f9296">DTLS_RECORD_LAYER_clear</a></div><div class="ttdeci">void DTLS_RECORD_LAYER_clear(RECORD_LAYER *rl)</div><div class="ttdef"><b>Definition:</b> <a href="rec__layer__d1_8c_source.html#l00055">rec_layer_d1.c:55</a></div></div>
<div class="ttc" id="d1__lib_8c_html_a3e5f57fb7fad8cbb2b3376a42b2bd555"><div class="ttname"><a href="d1__lib_8c.html#a3e5f57fb7fad8cbb2b3376a42b2bd555">dtls1_check_timeout_num</a></div><div class="ttdeci">int dtls1_check_timeout_num(SSL *s)</div><div class="ttdef"><b>Definition:</b> <a href="d1__lib_8c_source.html#l00341">d1_lib.c:341</a></div></div>
<div class="ttc" id="buffer_8h_html"><div class="ttname"><a href="buffer_8h.html">buffer.h</a></div></div>
<div class="ttc" id="record__locl_8h_html_a02cd8809c77bc3d39ef83db867463c82"><div class="ttname"><a href="record__locl_8h.html#a02cd8809c77bc3d39ef83db867463c82">SSL3_RECORD_get_length</a></div><div class="ttdeci">#define SSL3_RECORD_get_length(r)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00084">record_locl.h:84</a></div></div>
<div class="ttc" id="ssl_8h_html_a5937e98ddad766e0b7dd6c6b6cb6953f"><div class="ttname"><a href="ssl_8h.html#a5937e98ddad766e0b7dd6c6b6cb6953f">SSL_READING</a></div><div class="ttdeci">#define SSL_READING</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l00763">ssl.h:763</a></div></div>
<div class="ttc" id="rec__layer__d1_8c_html_a156a06924635389532145a5e5db18a95"><div class="ttname"><a href="rec__layer__d1_8c.html#a156a06924635389532145a5e5db18a95">dtls1_read_bytes</a></div><div class="ttdeci">int dtls1_read_bytes(SSL *s, int type, int *recvd_type, unsigned char *buf, size_t len, int peek, size_t *readbytes)</div><div class="ttdef"><b>Definition:</b> <a href="rec__layer__d1_8c_source.html#l00339">rec_layer_d1.c:339</a></div></div>
<div class="ttc" id="evp_8h_html_a44b4d4d994e27b818f85185a9d45fa81"><div class="ttname"><a href="evp_8h.html#a44b4d4d994e27b818f85185a9d45fa81">EVP_MD_CTX_size</a></div><div class="ttdeci">#define EVP_MD_CTX_size(e)</div><div class="ttdef"><b>Definition:</b> <a href="evp_8h_source.html#l00441">evp.h:441</a></div></div>
<div class="ttc" id="bss__dgram_8c_html_a09e63d1cdf0269f007905bb57911797e"><div class="ttname"><a href="bss__dgram_8c.html#a09e63d1cdf0269f007905bb57911797e">BIO_dgram_sctp_msg_waiting</a></div><div class="ttdeci">int BIO_dgram_sctp_msg_waiting(BIO *b)</div><div class="ttdef"><b>Definition:</b> <a href="bss__dgram_8c_source.html#l01786">bss_dgram.c:1786</a></div></div>
<div class="ttc" id="statem_8c_html_ae91ddf9b8a470a0f2e356cacb7995121"><div class="ttname"><a href="statem_8c.html#ae91ddf9b8a470a0f2e356cacb7995121">ossl_statem_set_in_init</a></div><div class="ttdeci">void ossl_statem_set_in_init(SSL *s, int init)</div><div class="ttdef"><b>Definition:</b> <a href="statem_8c_source.html#l00136">statem.c:136</a></div></div>
<div class="ttc" id="record__locl_8h_html_a6462bf53e9be4f2c7d9259c2a7ecb1d9"><div class="ttname"><a href="record__locl_8h.html#a6462bf53e9be4f2c7d9259c2a7ecb1d9">SSL3_RECORD_get_input</a></div><div class="ttdeci">#define SSL3_RECORD_get_input(r)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00090">record_locl.h:90</a></div></div>
<div class="ttc" id="ssl_8h_html_aa02414f420816d9aec68e677ed26aeb4"><div class="ttname"><a href="ssl_8h.html#aa02414f420816d9aec68e677ed26aeb4">SSL_SENT_SHUTDOWN</a></div><div class="ttdeci">#define SSL_SENT_SHUTDOWN</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l00207">ssl.h:207</a></div></div>
<div class="ttc" id="ssl_8h_html_a8bcb06e82fc1107090412d76163045f5"><div class="ttname"><a href="ssl_8h.html#a8bcb06e82fc1107090412d76163045f5">SSL_in_init</a></div><div class="ttdeci">int SSL_in_init(SSL *s)</div><div class="ttdef"><b>Definition:</b> <a href="statem_8c_source.html#l00069">statem.c:69</a></div></div>
<div class="ttc" id="structDTLS1__RECORD__DATA_html_acfd653e19cfeea50b4743edd7245df88"><div class="ttname"><a href="structDTLS1__RECORD__DATA.html#acfd653e19cfeea50b4743edd7245df88">DTLS1_RECORD_DATA::packet_length</a></div><div class="ttdeci">size_t packet_length</div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00085">record.h:85</a></div></div>
<div class="ttc" id="structhm__header__st_html_aa5044999f3339d2ba3b1bf22fa6cfe95"><div class="ttname"><a href="structhm__header__st.html#aa5044999f3339d2ba3b1bf22fa6cfe95">hm_header_st::type</a></div><div class="ttdeci">unsigned char type</div><div class="ttdef"><b>Definition:</b> <a href="ssl__locl_8h_source.html#l01421">ssl_locl.h:1421</a></div></div>
<div class="ttc" id="evp_8h_html_a963fe8dd8de3699cb3cc543440873823"><div class="ttname"><a href="evp_8h.html#a963fe8dd8de3699cb3cc543440873823">EVP_GCM_TLS_EXPLICIT_IV_LEN</a></div><div class="ttdeci">#define EVP_GCM_TLS_EXPLICIT_IV_LEN</div><div class="ttdef"><b>Definition:</b> <a href="evp_8h_source.html#l00361">evp.h:361</a></div></div>
<div class="ttc" id="rec__layer__d1_8c_html_a84fc61d7bb3adb768528dca79e5a7cdf"><div class="ttname"><a href="rec__layer__d1_8c.html#a84fc61d7bb3adb768528dca79e5a7cdf">dtls1_reset_seq_numbers</a></div><div class="ttdeci">void dtls1_reset_seq_numbers(SSL *s, int rw)</div><div class="ttdef"><b>Definition:</b> <a href="rec__layer__d1_8c_source.html#l01142">rec_layer_d1.c:1142</a></div></div>
<div class="ttc" id="structSSL3__RECORD_html_ae809d5359ac030c60a30a8f0b2294b82"><div class="ttname"><a href="structSSL3__RECORD.html#ae809d5359ac030c60a30a8f0b2294b82">SSL3_RECORD::length</a></div><div class="ttdeci">size_t length</div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00041">record.h:41</a></div></div>
<div class="ttc" id="statem_8c_html_adb23f211302fad874f72e889ee0cf2b3"><div class="ttname"><a href="statem_8c.html#adb23f211302fad874f72e889ee0cf2b3">ossl_statem_in_sctp_read_sock</a></div><div class="ttdeci">int ossl_statem_in_sctp_read_sock(SSL *s)</div><div class="ttdef"><b>Definition:</b> <a href="statem_8c_source.html#l00834">statem.c:834</a></div></div>
<div class="ttc" id="record__locl_8h_html_ab3d721980ec3ac03e60d8c23513eb56b"><div class="ttname"><a href="record__locl_8h.html#ab3d721980ec3ac03e60d8c23513eb56b">MAX_WARN_ALERT_COUNT</a></div><div class="ttdeci">#define MAX_WARN_ALERT_COUNT</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00017">record_locl.h:17</a></div></div>
<div class="ttc" id="structRECORD__LAYER_html_a773db95eb941ace70687563ac7737dd9"><div class="ttname"><a href="structRECORD__LAYER.html#a773db95eb941ace70687563ac7737dd9">RECORD_LAYER::write_sequence</a></div><div class="ttdeci">unsigned char write_sequence[SEQ_NUM_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00178">record.h:178</a></div></div>
<div class="ttc" id="structRECORD__LAYER_html"><div class="ttname"><a href="structRECORD__LAYER.html">RECORD_LAYER</a></div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00135">record.h:135</a></div></div>
<div class="ttc" id="d1__lib_8c_html_ae9ef4caa95d87180cd12359f2c62f4d5"><div class="ttname"><a href="d1__lib_8c.html#ae9ef4caa95d87180cd12359f2c62f4d5">dtls1_handle_timeout</a></div><div class="ttdeci">int dtls1_handle_timeout(SSL *s)</div><div class="ttdef"><b>Definition:</b> <a href="d1__lib_8c_source.html#l00365">d1_lib.c:365</a></div></div>
<div class="ttc" id="ssl_8h_html_a77d177dc7fea2e76174c3a3e3de6b39b"><div class="ttname"><a href="ssl_8h.html#a77d177dc7fea2e76174c3a3e3de6b39b">SSL_ST_READ_BODY</a></div><div class="ttdeci">#define SSL_ST_READ_BODY</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l00937">ssl.h:937</a></div></div>
<div class="ttc" id="rec__layer__s3_8c_html_a740a746da04337932287b5c891f5408a"><div class="ttname"><a href="rec__layer__s3_8c.html#a740a746da04337932287b5c891f5408a">ssl3_write_pending</a></div><div class="ttdeci">int ssl3_write_pending(SSL *s, int type, const unsigned char *buf, size_t len, size_t *written)</div><div class="ttdef"><b>Definition:</b> <a href="rec__layer__s3_8c_source.html#l01004">rec_layer_s3.c:1004</a></div></div>
<div class="ttc" id="record__locl_8h_html_aac0493b345e27573e2f8d97359668dac"><div class="ttname"><a href="record__locl_8h.html#aac0493b345e27573e2f8d97359668dac">SSL3_RECORD_set_data</a></div><div class="ttdeci">#define SSL3_RECORD_set_data(r, d)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00089">record_locl.h:89</a></div></div>
<div class="ttc" id="e__des3_8c_html_ab709b098f24ad7cc05fc6eb2df218a27"><div class="ttname"><a href="e__des3_8c.html#ab709b098f24ad7cc05fc6eb2df218a27">NULL</a></div><div class="ttdeci">EVP_CIPH_RAND_KEY NULL</div><div class="ttdef"><b>Definition:</b> <a href="e__des3_8c_source.html#l00213">e_des3.c:213</a></div></div>
<div class="ttc" id="ssl3_8h_html_a198c2af04c8f09f7012a8a9c0cfe2f46"><div class="ttname"><a href="ssl3_8h.html#a198c2af04c8f09f7012a8a9c0cfe2f46">SSL3_AL_FATAL</a></div><div class="ttdeci">#define SSL3_AL_FATAL</div><div class="ttdef"><b>Definition:</b> <a href="ssl3_8h_source.html#l00227">ssl3.h:227</a></div></div>
<div class="ttc" id="structSSL3__BUFFER_html_ac8ed9b9edf72a0bbde1ba01f0c67ef73"><div class="ttname"><a href="structSSL3__BUFFER.html#ac8ed9b9edf72a0bbde1ba01f0c67ef73">SSL3_BUFFER::buf</a></div><div class="ttdeci">unsigned char * buf</div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00019">record.h:19</a></div></div>
<div class="ttc" id="ssl3_8h_html_a8df25aafb22ec245bc2c74099fb70091"><div class="ttname"><a href="ssl3_8h.html#a8df25aafb22ec245bc2c74099fb70091">SSL3_AL_WARNING</a></div><div class="ttdeci">#define SSL3_AL_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="ssl3_8h_source.html#l00226">ssl3.h:226</a></div></div>
<div class="ttc" id="ssl_8h_html_ae636aa8c372a9b15174d8f25fa3093e3"><div class="ttname"><a href="ssl_8h.html#ae636aa8c372a9b15174d8f25fa3093e3">SSL_AD_REASON_OFFSET</a></div><div class="ttdeci">#define SSL_AD_REASON_OFFSET</div></div>
<div class="ttc" id="ssl_8h_html_adda5f067eef1a4868484abb8fe45287e"><div class="ttname"><a href="ssl_8h.html#adda5f067eef1a4868484abb8fe45287e">SSL_AD_UNEXPECTED_MESSAGE</a></div><div class="ttdeci">#define SSL_AD_UNEXPECTED_MESSAGE</div></div>
<div class="ttc" id="ssl_8h_html_ad5ba194c84ab706f94cde94d02296ff3"><div class="ttname"><a href="ssl_8h.html#ad5ba194c84ab706f94cde94d02296ff3">SSL_F_DTLS1_READ_BYTES</a></div><div class="ttdeci">#define SSL_F_DTLS1_READ_BYTES</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l02106">ssl.h:2106</a></div></div>
<div class="ttc" id="rec__layer__d1_8c_html_aa2e1499ab8df139c1bd6a4abc6cf5550"><div class="ttname"><a href="rec__layer__d1_8c.html#aa2e1499ab8df139c1bd6a4abc6cf5550">dtls1_write_bytes</a></div><div class="ttdeci">int dtls1_write_bytes(SSL *s, int type, const void *buf, size_t len, size_t *written)</div><div class="ttdef"><b>Definition:</b> <a href="rec__layer__d1_8c_source.html#l00905">rec_layer_d1.c:905</a></div></div>
<div class="ttc" id="record__locl_8h_html_a8a8fa930ff9d5578c68f31001fcdd765"><div class="ttname"><a href="record__locl_8h.html#a8a8fa930ff9d5578c68f31001fcdd765">SSL3_BUFFER_get_left</a></div><div class="ttdeci">#define SSL3_BUFFER_get_left(b)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00063">record_locl.h:63</a></div></div>
<div class="ttc" id="ssl_8h_html_a0670a14fbc4206622336d9cea3bb03f7"><div class="ttname"><a href="ssl_8h.html#a0670a14fbc4206622336d9cea3bb03f7">SSL_R_SSL_HANDSHAKE_FAILURE</a></div><div class="ttdeci">#define SSL_R_SSL_HANDSHAKE_FAILURE</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l02589">ssl.h:2589</a></div></div>
<div class="ttc" id="rec__layer__d1_8c_html_a8a7e26d5d3fc9399cdaaebb051c51d15"><div class="ttname"><a href="rec__layer__d1_8c.html#a8a7e26d5d3fc9399cdaaebb051c51d15">dtls1_get_bitmap</a></div><div class="ttdeci">DTLS1_BITMAP * dtls1_get_bitmap(SSL *s, SSL3_RECORD *rr, unsigned int *is_next_epoch)</div><div class="ttdef"><b>Definition:</b> <a href="rec__layer__d1_8c_source.html#l01117">rec_layer_d1.c:1117</a></div></div>
<div class="ttc" id="ct__locl_8h_html_afd464cc3fd54170b0469540b665914fd"><div class="ttname"><a href="ct__locl_8h.html#afd464cc3fd54170b0469540b665914fd">n2s</a></div><div class="ttdeci">#define n2s(c, s)</div><div class="ttdef"><b>Definition:</b> <a href="ct__locl_8h_source.html#l00028">ct_locl.h:28</a></div></div>
<div class="ttc" id="ssl_8h_html_a1a7aef992a2aa0c2f74935f20149c7e3"><div class="ttname"><a href="ssl_8h.html#a1a7aef992a2aa0c2f74935f20149c7e3">SSL_AD_CLOSE_NOTIFY</a></div><div class="ttdeci">#define SSL_AD_CLOSE_NOTIFY</div></div>
<div class="ttc" id="crypto_8h_html_afdb80d14aed3b15d0ef71f72a872310d"><div class="ttname"><a href="crypto_8h.html#afdb80d14aed3b15d0ef71f72a872310d">OPENSSL_malloc</a></div><div class="ttdeci">#define OPENSSL_malloc(num)</div><div class="ttdef"><b>Definition:</b> <a href="crypto_8h_source.html#l00126">crypto.h:126</a></div></div>
<div class="ttc" id="structSSL3__RECORD_html"><div class="ttname"><a href="structSSL3__RECORD.html">SSL3_RECORD</a></div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00032">record.h:32</a></div></div>
<div class="ttc" id="dtls1_8h_html_a313ba59cb24cf778204cfff800bebc4c"><div class="ttname"><a href="dtls1_8h.html#a313ba59cb24cf778204cfff800bebc4c">DTLS1_HM_HEADER_LENGTH</a></div><div class="ttdeci">#define DTLS1_HM_HEADER_LENGTH</div><div class="ttdef"><b>Definition:</b> <a href="dtls1_8h_source.html#l00033">dtls1.h:33</a></div></div>
<div class="ttc" id="bss__dgram_8c_html_a1f335fa8b46ddcdfc52cf260781363f9"><div class="ttname"><a href="bss__dgram_8c.html#a1f335fa8b46ddcdfc52cf260781363f9">BIO_dgram_is_sctp</a></div><div class="ttdeci">int BIO_dgram_is_sctp(BIO *bio)</div><div class="ttdef"><b>Definition:</b> <a href="bss__dgram_8c_source.html#l00940">bss_dgram.c:940</a></div></div>
<div class="ttc" id="dtls1_8h_html_a761d8f994778953299d0f50c0fd4da62"><div class="ttname"><a href="dtls1_8h.html#a761d8f994778953299d0f50c0fd4da62">DTLS_ANY_VERSION</a></div><div class="ttdeci">#define DTLS_ANY_VERSION</div><div class="ttdef"><b>Definition:</b> <a href="dtls1_8h_source.html#l00026">dtls1.h:26</a></div></div>
<div class="ttc" id="structSSL3__RECORD_html_aa9d2cadf47d8209c657a3e128a17bf44"><div class="ttname"><a href="structSSL3__RECORD.html#aa9d2cadf47d8209c657a3e128a17bf44">SSL3_RECORD::epoch</a></div><div class="ttdeci">unsigned long epoch</div><div class="ttdef"><b>Definition:</b> <a href="record_8h_source.html#l00065">record.h:65</a></div></div>
<div class="ttc" id="ssl_8h_html_a0b1799f93fc382f92cb1ba58a25b1c90"><div class="ttname"><a href="ssl_8h.html#a0b1799f93fc382f92cb1ba58a25b1c90">SSL_CTX_remove_session</a></div><div class="ttdeci">int SSL_CTX_remove_session(SSL_CTX *, SSL_SESSION *c)</div><div class="ttdef"><b>Definition:</b> <a href="ssl__sess_8c_source.html#l00725">ssl_sess.c:725</a></div></div>
<div class="ttc" id="rec__layer__d1_8c_html_aba659edf920d1ee1322a269417c869bd"><div class="ttname"><a href="rec__layer__d1_8c.html#aba659edf920d1ee1322a269417c869bd">dtls1_get_unprocessed_record</a></div><div class="ttdeci">#define dtls1_get_unprocessed_record(s)</div><div class="ttdef"><b>Definition:</b> <a href="rec__layer__d1_8c_source.html#l00226">rec_layer_d1.c:226</a></div></div>
<div class="ttc" id="crypto_8h_html_a6e3638bf542fc7a6a394f34124aa2cba"><div class="ttname"><a href="crypto_8h.html#a6e3638bf542fc7a6a394f34124aa2cba">OPENSSL_assert</a></div><div class="ttdeci">#define OPENSSL_assert(e)</div><div class="ttdef"><b>Definition:</b> <a href="crypto_8h_source.html#l00328">crypto.h:328</a></div></div>
<div class="ttc" id="record__locl_8h_html_ae69454bd8c71d7de11ca2c0d85388749"><div class="ttname"><a href="record__locl_8h.html#ae69454bd8c71d7de11ca2c0d85388749">SSL3_RECORD_add_off</a></div><div class="ttdeci">#define SSL3_RECORD_add_off(r, o)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00096">record_locl.h:96</a></div></div>
<div class="ttc" id="ssl_8h_html_ade818ef4efdc44c84043909e4b466d3b"><div class="ttname"><a href="ssl_8h.html#ade818ef4efdc44c84043909e4b466d3b">SSL_get_rbio</a></div><div class="ttdeci">__owur BIO * SSL_get_rbio(const SSL *s)</div><div class="ttdef"><b>Definition:</b> <a href="ssl__lib_8c_source.html#l01106">ssl_lib.c:1106</a></div></div>
<div class="ttc" id="ssl3_8h_html_ac2ed784b96ecdc1d92d805793dd8a14c"><div class="ttname"><a href="ssl3_8h.html#ac2ed784b96ecdc1d92d805793dd8a14c">SSL3_RT_ALERT</a></div><div class="ttdeci">#define SSL3_RT_ALERT</div><div class="ttdef"><b>Definition:</b> <a href="ssl3_8h_source.html#l00204">ssl3.h:204</a></div></div>
<div class="ttc" id="evp_8h_html_a3b159d81dd9118d614885aad3630b4be"><div class="ttname"><a href="evp_8h.html#a3b159d81dd9118d614885aad3630b4be">EVP_CCM_TLS_EXPLICIT_IV_LEN</a></div><div class="ttdeci">#define EVP_CCM_TLS_EXPLICIT_IV_LEN</div><div class="ttdef"><b>Definition:</b> <a href="evp_8h_source.html#l00369">evp.h:369</a></div></div>
<div class="ttc" id="record__locl_8h_html_afb43c2a006def3dac987d320cd6edb57"><div class="ttname"><a href="record__locl_8h.html#afb43c2a006def3dac987d320cd6edb57">RECORD_LAYER_get_rrec</a></div><div class="ttdeci">#define RECORD_LAYER_get_rrec(rl)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00023">record_locl.h:23</a></div></div>
<div class="ttc" id="record__locl_8h_html_ab587c0e5dba08b9af1113b72878078c5"><div class="ttname"><a href="record__locl_8h.html#ab587c0e5dba08b9af1113b72878078c5">RECORD_LAYER_reset_packet_length</a></div><div class="ttdeci">#define RECORD_LAYER_reset_packet_length(rl)</div><div class="ttdef"><b>Definition:</b> <a href="record__locl_8h_source.html#l00025">record_locl.h:25</a></div></div>
<div class="ttc" id="ssl3_8h_html_ae714280a93e6ebbf190053c62803f070"><div class="ttname"><a href="ssl3_8h.html#ae714280a93e6ebbf190053c62803f070">SSL3_CC_READ</a></div><div class="ttdeci">#define SSL3_CC_READ</div><div class="ttdef"><b>Definition:</b> <a href="ssl3_8h_source.html#l00302">ssl3.h:302</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_2228e0ed1737b712482302273d822134.html">ssl</a></li><li class="navelem"><a class="el" href="dir_e3c709b9b80ee75d59b4ba5ace4a2ff7.html">record</a></li><li class="navelem"><a class="el" href="rec__layer__d1_8c.html">rec_layer_d1.c</a></li>
    <li class="footer">Generated on Fri Feb 17 2017 23:57:31 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.12 </li>
  </ul>
</div>
</body>
</html>
